

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>src.core.action &mdash; Transport Experiment 1.5.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Transport Experiment 1.5.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Transport Experiment 1.5.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for src.core.action</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Object-oriented representation of interactions with instruments.</span>

<span class="sd">An `Action` is an operation on an instrument to set data, retrieve data, or </span>
<span class="sd">both. The following types of actions are supported by this module.</span>

<span class="sd">Action: </span>
<span class="sd">    An `Action` is some operation which should be performed on an instrument. </span>
<span class="sd">    It serves as the base class of several types of container actions. Normally,</span>
<span class="sd">    an instance of `Action` will perform some simple read or write operation</span>
<span class="sd">    on the instrument.</span>
<span class="sd">ActionScan: </span>
<span class="sd">    An `ActionScan` is a container for other `Action` objects which </span>
<span class="sd">    executes its children at each value of some parameter.</span>
<span class="sd">ActionSimultaneous: </span>
<span class="sd">    An `ActionSimultaneous` is a container for other `Action` objects which</span>
<span class="sd">    spawns threads for each of its children and begins those threads at the same</span>
<span class="sd">    time so that they run in parallel.</span>
<span class="sd">    </span>
<span class="sd">Parameter:</span>
<span class="sd">    A `Parameter` is an atomic input or output. It consists of the value of </span>
<span class="sd">    the input (typically set by the user) or output (typically set by the </span>
<span class="sd">    `Instrument` which actually carries out the `Action` which owns the </span>
<span class="sd">    it), information to indicate to the user what it represents, a string to </span>
<span class="sd">    determine how to format its numeric values, and directions regarding how and</span>
<span class="sd">    where the data should be saved.</span>
<span class="sd">        </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">Template</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">clock</span><span class="p">,</span> <span class="n">sleep</span>

<span class="kn">from</span> <span class="nn">src.core</span> <span class="kn">import</span> <span class="n">progress</span>
<span class="kn">from</span> <span class="nn">src.core.errors</span> <span class="kn">import</span> <span class="n">InvalidInputError</span>
<span class="kn">from</span> <span class="nn">src.tools</span> <span class="kn">import</span> <span class="n">general</span> <span class="k">as</span> <span class="n">gentools</span>
<span class="kn">from</span> <span class="nn">src.tools.parsing</span> <span class="kn">import</span> <span class="n">escapeXML</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;transport&#39;</span><span class="p">)</span>

<span class="n">PARAM_ID</span> <span class="o">=</span> <span class="s">&#39;$&#39;</span>



<span class="n">TOLERANCE</span> <span class="o">=</span> <span class="mf">1E-10</span>


<span class="c">#------------------------------------------------------------- Action - Standard</span>

<div class="viewcode-block" id="Action"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action">[docs]</a><span class="k">class</span> <span class="nc">Action</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A single action to perform a simple get/set/query on an instrument.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    experiment : Experiment</span>
<span class="sd">        The `Experiment` object to which this action belongs.</span>
<span class="sd">    instrument : Instrument</span>
<span class="sd">        The `Instrument` object which will perform this action (though not</span>
<span class="sd">        necessarily its children).</span>
<span class="sd">    name : str</span>
<span class="sd">        A short name with no special characters except (possibly) an </span>
<span class="sd">        underscore, to use for looking up this action.</span>
<span class="sd">    description : str</span>
<span class="sd">        A short phrase to indicate what this action does.</span>
<span class="sd">    inputs : list of Parameter</span>
<span class="sd">        A list of `Parameter` objects which this action will pass to the</span>
<span class="sd">        instrument.</span>
<span class="sd">    outputs : list of Parameter</span>
<span class="sd">        A list of `Parameter` objects which the instrument will fill in and</span>
<span class="sd">        pass back to this action to be processed and, in most cases, written</span>
<span class="sd">        to the appropriate files.</span>
<span class="sd">    string : str</span>
<span class="sd">        A template string which can be filled in with input values to provide</span>
<span class="sd">        the user with a specific description of what this action will do.</span>
<span class="sd">    method : instancemethod</span>
<span class="sd">        The method bound to `instrument` which will actually carry out this</span>
<span class="sd">        action.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span>
                 <span class="n">inputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new action.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span> <span class="o">=</span> <span class="n">experiment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span> <span class="o">=</span> <span class="n">instrument</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_templateString</span> <span class="o">=</span> <span class="n">string</span>

        <span class="k">if</span> <span class="n">inputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">outputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span> <span class="o">=</span> <span class="n">outputs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_methodString</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_methodString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method</span><span class="o">.</span><span class="n">__name__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_methodString</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_inputSubs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statusMonitor</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">getStatusMonitor</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Action.setExperiment"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.setExperiment">[docs]</a>    <span class="k">def</span> <span class="nf">setExperiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newExperiment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the experiment which owns this action and its parameters.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        newExperiment : Experiment</span>
<span class="sd">            The `Experiment` object which should own this action.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span> <span class="o">=</span> <span class="n">newExperiment</span>
        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">:</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">experiment</span> <span class="o">=</span> <span class="n">newExperiment</span>
</div>
<div class="viewcode-block" id="Action.setStatusMonitor"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.setStatusMonitor">[docs]</a>    <span class="k">def</span> <span class="nf">setStatusMonitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statusMonitor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the status monitor for the action.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        statusMonitor : StatusMonitor</span>
<span class="sd">            The new `StatusMonitor` object for this action.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statusMonitor</span> <span class="o">=</span> <span class="n">statusMonitor</span>
</div>
<div class="viewcode-block" id="Action.instantiate"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.instantiate">[docs]</a>    <span class="k">def</span> <span class="nf">instantiate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Instantiate all parameters, establishing the necessary data storage.</span>
<span class="sd">        </span>
<span class="sd">        Create the appropriate data bins---based on the default names of the </span>
<span class="sd">        input/output columns and parameters---in the experiment file (using the</span>
<span class="sd">        instantiate method of the `Parameter` class).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">instantiate</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">instantiate</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Action.setEnabled"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.setEnabled">[docs]</a>    <span class="k">def</span> <span class="nf">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set whether this action will actually be executed.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        enabled : bool</span>
<span class="sd">            Whether to execute this action when the experiment is run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span> <span class="o">=</span> <span class="n">enabled</span>
</div>
<div class="viewcode-block" id="Action.isEnabled"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.isEnabled">[docs]</a>    <span class="k">def</span> <span class="nf">isEnabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get whether this action will be executed when the experiment is run.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            Whether this action will actually be executed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span>
</div>
<div class="viewcode-block" id="Action.getName"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.getName">[docs]</a>    <span class="k">def</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the name of the action.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</div>
<div class="viewcode-block" id="Action.getDescription"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.getDescription">[docs]</a>    <span class="k">def</span> <span class="nf">getDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the description of the action.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the long description string with values substituted.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            An informative description of this action, formed by substituting</span>
<span class="sd">            input values into the template string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;ActionSequence:&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;(disabled) &#39;</span>
        <span class="n">ans</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_templateString</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ans</span> <span class="o">+</span> <span class="s">&#39;do something, or maybe nothing.&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">anInput</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">:</span>
                <span class="n">subs</span><span class="p">[</span><span class="n">anInput</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">anInput</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">ans</span> <span class="o">+</span> <span class="n">Template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_templateString</span><span class="p">)</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span>

<div class="viewcode-block" id="Action.getTreeString"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.getTreeString">[docs]</a>    <span class="k">def</span> <span class="nf">getTreeString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a descriptive string with appropriate indentation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span> <span class="o">*</span> <span class="n">depth</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Action.printme"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.printme">[docs]</a>    <span class="k">def</span> <span class="nf">printme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print a descriptive string with appropriate indentation.&quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTreeString</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Action.getInstrument"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.getInstrument">[docs]</a>    <span class="k">def</span> <span class="nf">getInstrument</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the instrument bound to this action.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Instrument</span>
<span class="sd">            The `Instrument` object bound to this action.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span>
</div>
<div class="viewcode-block" id="Action.setInstrument"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.setInstrument">[docs]</a>    <span class="k">def</span> <span class="nf">setInstrument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Bind an new instrument to this action.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        inst : Instrument</span>
<span class="sd">            The `Instrument` object which will perform the action.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span> <span class="o">=</span> <span class="n">inst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s">&#39;self._inst.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_methodString</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Action.getInstrumentName"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.getInstrumentName">[docs]</a>    <span class="k">def</span> <span class="nf">getInstrumentName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the name of the instrument which will perform the action.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A string indicating the name of the `Instrument` which will</span>
<span class="sd">            perform the action.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Action.setInputValues"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.setInputValues">[docs]</a>    <span class="k">def</span> <span class="nf">setInputValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputValues</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the values which will be sent to the ``Instrument`` object.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">inputObject</span><span class="p">,</span> <span class="n">newValue</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">,</span> <span class="n">inputValues</span><span class="p">):</span>
            <span class="n">inputObject</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">newValue</span>
</div>
<div class="viewcode-block" id="Action.getInputColumns"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.getInputColumns">[docs]</a>    <span class="k">def</span> <span class="nf">getInputColumns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the input columns.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            A list of strings representing the names of the columns or </span>
<span class="sd">            parameters to which the input values will be saved when the action</span>
<span class="sd">            is executed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">:</span>
            <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">binName</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ans</span>
</div>
<div class="viewcode-block" id="Action.setInputColumns"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.setInputColumns">[docs]</a>    <span class="k">def</span> <span class="nf">setInputColumns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputColumns</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the input columns.</span>
<span class="sd">        </span>
<span class="sd">        Set the column names (or parameter names) to which the input values </span>
<span class="sd">        will be saved when the action is executed.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        inputColumns : list of str</span>
<span class="sd">            A list of strings representing the names of the columns or</span>
<span class="sd">            parameters to which the input values should be saved when the</span>
<span class="sd">            action is executed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">anInput</span><span class="p">,</span> <span class="n">inputColumn</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">,</span> <span class="n">inputColumns</span><span class="p">):</span>
            <span class="n">anInput</span><span class="o">.</span><span class="n">binName</span> <span class="o">=</span> <span class="n">inputColumn</span>
</div>
<div class="viewcode-block" id="Action.getInputProperties"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.getInputProperties">[docs]</a>    <span class="k">def</span> <span class="nf">getInputProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the input properties for the action.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of dict</span>
<span class="sd">            A list of dictionaries containing information about the input</span>
<span class="sd">            parameters. The following keys will be present.</span>
<span class="sd">                - description</span>
<span class="sd">                - column (name of the column or parameter)</span>
<span class="sd">                - value (as a formatted string)</span>
<span class="sd">                - allowed</span>
<span class="sd">                - formatString</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">binName</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">curr</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                    <span class="s">&#39;column&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                    <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">getFormattedValue</span><span class="p">(),</span>
                    <span class="s">&#39;allowed&#39;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">allowedValues</span><span class="p">,</span>
                    <span class="s">&#39;format_string&#39;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">formatString</span>
                   <span class="p">}</span>
            <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ans</span>
</div>
<div class="viewcode-block" id="Action.replaceStringInInput"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.replaceStringInInput">[docs]</a>    <span class="k">def</span> <span class="nf">replaceStringInInput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputIndex</span><span class="p">,</span> <span class="n">original</span><span class="p">,</span> <span class="n">replacement</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform a string replacement in one of the inputs for this action.</span>
<span class="sd">        </span>
<span class="sd">        The primary purpose of this method is to update expressions (either</span>
<span class="sd">        for calculations or for conditionals) to reflect changes in the names</span>
<span class="sd">        of columns, parameters, or constants.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        inputIndex : int</span>
<span class="sd">            The index in the list of input parameters of the parameter</span>
<span class="sd">            where the replacement should take place.</span>
<span class="sd">        original : str</span>
<span class="sd">            The string which should be replaced.</span>
<span class="sd">        replacement : str</span>
<span class="sd">            The string which should go in place of `original`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">oldval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="n">inputIndex</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="n">newval</span> <span class="o">=</span> <span class="n">oldval</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">replacement</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="n">inputIndex</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">newval</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Replacement fail: </span><span class="si">%s</span><span class="s"> with </span><span class="si">%s</span><span class="s"> at index </span><span class="si">%d</span><span class="s">&#39;</span><span class="p">,</span>
                      <span class="n">original</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">inputIndex</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Action.getOutputColumns"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.getOutputColumns">[docs]</a>    <span class="k">def</span> <span class="nf">getOutputColumns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the output column names.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            A list of strings representing the names of the columns or</span>
<span class="sd">            parameters to which the output values will be saved when the action</span>
<span class="sd">            is executed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">:</span>
            <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">binName</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ans</span>
</div>
<div class="viewcode-block" id="Action.setOutputColumns"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.setOutputColumns">[docs]</a>    <span class="k">def</span> <span class="nf">setOutputColumns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputColumns</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the output column names.</span>
<span class="sd">        </span>
<span class="sd">        Set the column names (or parameter names) to which the output values </span>
<span class="sd">        will be saved when the action is executed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">columnName</span><span class="p">,</span> <span class="n">parameter</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">outputColumns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">):</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">binName</span> <span class="o">=</span> <span class="n">columnName</span>
</div>
<div class="viewcode-block" id="Action.getOutputProperties"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.getOutputProperties">[docs]</a>    <span class="k">def</span> <span class="nf">getOutputProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the output properties for the action.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of dict</span>
<span class="sd">            A list of dictionaries. Each dictionary corresponds to one output</span>
<span class="sd">            and contains the following keys:</span>
<span class="sd">                - &#39;description&#39;</span>
<span class="sd">                - &#39;column&#39;</span>
<span class="sd">                - &#39;allowed&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">binName</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                        <span class="s">&#39;column&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                        <span class="s">&#39;allowed&#39;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">allowedValues</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">ans</span>
</div>
<div class="viewcode-block" id="Action.prepareToExecute"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.prepareToExecute">[docs]</a>    <span class="k">def</span> <span class="nf">prepareToExecute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepare to execute by creating a substitution dictionary.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputSubs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputSubs</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="n">nullFunction</span>
</div>
<div class="viewcode-block" id="Action.execute"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obeyPause</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the action.</span>
<span class="sd">        </span>
<span class="sd">        If the experiment has been aborted, return. If it is paused, wait.</span>
<span class="sd">        Otherwise, execute the action, and then save the data to the file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obeyPause : bool</span>
<span class="sd">            Whether to wait until the experiment is no longer paused before</span>
<span class="sd">            executing the action.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="k">while</span> <span class="n">obeyPause</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isPaused</span><span class="p">():</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">inputParameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">:</span>
                <span class="n">inputParameter</span><span class="o">.</span><span class="n">saveData</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputSubs</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">outputParameter</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
                <span class="n">outputParameter</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">outputParameter</span><span class="o">.</span><span class="n">saveData</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Action.cleanupAfterExecution"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.cleanupAfterExecution">[docs]</a>    <span class="k">def</span> <span class="nf">cleanupAfterExecution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cleanup after execution.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="ow">is</span> <span class="n">nullFunction</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputSubs</span> <span class="o">=</span> <span class="p">{}</span>


    <span class="c">#===========================================================================</span>
    <span class="c"># State-variable commands</span>
    <span class="c">#===========================================================================</span>
</div>
<div class="viewcode-block" id="Action.clone"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Duplicate this action.</span>
<span class="sd">        </span>
<span class="sd">        Produce a new `Action` instance---with a new location in </span>
<span class="sd">        memory---which is the same as this one in all respects. This is for </span>
<span class="sd">        copy-and-paste operations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newClass</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>

        <span class="n">newInputs</span> <span class="o">=</span> <span class="n">cloneParameterList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">)</span>
        <span class="n">newOutputs</span> <span class="o">=</span> <span class="n">cloneParameterList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">newClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">,</span>
                            <span class="n">newInputs</span><span class="p">,</span> <span class="n">newOutputs</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_templateString</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_method</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Action.isEqualEnough"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.isEqualEnough">[docs]</a>    <span class="k">def</span> <span class="nf">isEqualEnough</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">otherSpec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine whether the other action is interchangeable with this one.</span>
<span class="sd">        </span>
<span class="sd">        To decide whether some action can be reasonably bound to a different</span>
<span class="sd">        instrument, consider whether the two actions have the same description,</span>
<span class="sd">        the same name, and input and output arrays. Two arrays are said to be</span>
<span class="sd">        &#39;the same&#39; if there is a one-to-one mapping of parameters between them</span>
<span class="sd">        where the two parameters have the same name, description, and format</span>
<span class="sd">        strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">otherArgs</span> <span class="o">=</span> <span class="n">otherSpec</span><span class="o">.</span><span class="n">args</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">!=</span> <span class="n">otherArgs</span><span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s">&#39;inputs&#39;</span> <span class="ow">in</span> <span class="n">otherArgs</span> <span class="ow">or</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">otherArgs</span><span class="p">[</span><span class="s">&#39;inputs&#39;</span><span class="p">])):</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">mine</span><span class="p">,</span> <span class="n">his</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">,</span> <span class="n">otherArgs</span><span class="p">[</span><span class="s">&#39;inputs&#39;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mine</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">his</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span>
                    <span class="n">mine</span><span class="o">.</span><span class="n">description</span> <span class="o">!=</span> <span class="n">his</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="ow">or</span>
                    <span class="n">mine</span><span class="o">.</span><span class="n">formatString</span> <span class="o">!=</span> <span class="n">his</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;formatString&#39;</span><span class="p">]):</span>
                    <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s">&#39;outputs&#39;</span> <span class="ow">in</span> <span class="n">otherArgs</span> <span class="ow">or</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">otherArgs</span><span class="p">[</span><span class="s">&#39;outputs&#39;</span><span class="p">])):</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">mine</span><span class="p">,</span> <span class="n">his</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">,</span> <span class="n">otherArgs</span><span class="p">[</span><span class="s">&#39;outputs&#39;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mine</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">his</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span>
                    <span class="n">mine</span><span class="o">.</span><span class="n">description</span> <span class="o">!=</span> <span class="n">his</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="ow">or</span>
                    <span class="n">mine</span><span class="o">.</span><span class="n">formatString</span> <span class="o">!=</span> <span class="n">his</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;formatString&#39;</span><span class="p">]):</span>
                    <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Action.trash"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.trash">[docs]</a>    <span class="k">def</span> <span class="nf">trash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Destroy the action.</span>
<span class="sd">        </span>
<span class="sd">        Set all of the bin (column or parameter) names to blanks, which removes</span>
<span class="sd">        them from the owning experiment&#39;s relevant dictionaries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">binName</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">binName</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</div>
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the method reference for pickling purposes.&quot;&quot;&quot;</span>
        <span class="n">odict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_method&#39;</span><span class="p">]</span>
<span class="c">#         if &#39;_loopEnterCommands&#39; in odict:</span>
<span class="c">#             del odict[&#39;_loopEnterCommands&#39;]</span>
<span class="c">#         if &#39;_loopExitCommands&#39; in odict:</span>
<span class="c">#             del odict[&#39;_loopExitCommands&#39;]</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_statusMonitor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">odict</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reinstate the method reference after loading from a file.&quot;&quot;&quot;</span>
        <span class="n">methodString</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s">&#39;_methodString&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">methodString</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s">&#39;dictionary[&quot;_inst&quot;].&#39;</span> <span class="o">+</span> <span class="n">methodString</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statusMonitor</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">getStatusMonitor</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
        
<div class="viewcode-block" id="Action.getXML"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.getXML">[docs]</a>    <span class="k">def</span> <span class="nf">getXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an XML string representing the action.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A string containing XML data representing all of the data related</span>
<span class="sd">            to the action, possibly useful as an alternative to pickle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">indent</span> <span class="o">+</span> <span class="s">&#39;&lt;action class=&quot;</span><span class="si">%s</span><span class="s">&quot; instrument_name=&quot;</span><span class="si">%s</span><span class="s">&quot; &#39;</span>
                <span class="s">&#39;name=&quot;</span><span class="si">%s</span><span class="s">&quot; enabled=&quot;</span><span class="si">%s</span><span class="s">&quot; &#39;</span> <span class="o">%</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">escapeXML</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inst</span><span class="p">)),</span> 
                 <span class="n">escapeXML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ActionLoopTimed</span><span class="p">):</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="p">[</span><span class="n">base</span> <span class="o">+</span> <span class="s">&#39;duration=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_duration</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ActionLoopIterations</span><span class="p">):</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="p">[</span><span class="n">base</span> <span class="o">+</span> <span class="s">&#39;iterations=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iterations</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ActionLoopWhile</span><span class="p">):</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="p">[</span><span class="n">base</span> <span class="o">+</span> <span class="s">&#39;expression=&quot;</span><span class="si">%s</span><span class="s">&quot; timeout=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;&#39;</span> <span class="o">%</span>
                   <span class="p">(</span><span class="n">escapeXML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="p">[</span><span class="n">base</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span><span class="p">]</span>
            <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&lt;inputs&gt;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">:</span>
                <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getXML</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&lt;/inputs&gt;&#39;</span><span class="p">)</span>
            <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&lt;outputs&gt;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">:</span>
                <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getXML</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&lt;/outputs&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowsChildren</span><span class="p">():</span>
            <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&lt;children&gt;&#39;</span><span class="p">)</span>
            <span class="n">ans</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">getXML</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">])</span>
            <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&lt;/children&gt;&#39;</span><span class="p">)</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">indent</span> <span class="o">+</span> <span class="s">&#39;&lt;/action&gt;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Action.allowsChildren"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Action.allowsChildren">[docs]</a>    <span class="k">def</span> <span class="nf">allowsChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether this action can have children.</span>
<span class="sd">        </span>
<span class="sd">        Since members of the `Action` class (i.e. not a derived class) are </span>
<span class="sd">        *simple* actions, they cannot have children.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ActionContainer</span><span class="p">)</span>


<span class="c">#-------------------------------------------------------- Action - Postprocessor</span>
</div></div>
<div class="viewcode-block" id="ActionPostprocessor"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionPostprocessor">[docs]</a><span class="k">class</span> <span class="nc">ActionPostprocessor</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An action for postprocessor events.</span>
<span class="sd">    </span>
<span class="sd">    The postprocessor actions all follow the same format. They take a</span>
<span class="sd">    single argument: a list of tuples representing the files created by the</span>
<span class="sd">    experiment. Note that all postprocessor actions are executed together at</span>
<span class="sd">    the end of the experiment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span>
                 <span class="n">sourceFile</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ActionPostprocessor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                                                  <span class="n">description</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                                                  <span class="n">description</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sourceFile</span> <span class="o">=</span> <span class="n">sourceFile</span>
        
<div class="viewcode-block" id="ActionPostprocessor.execute"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionPostprocessor.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obeyPause</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add the action to the experiment&#39;s postprocessor action queue.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obeyPause : bool</span>
<span class="sd">            Whether to wait until the experiment is no longer paused before</span>
<span class="sd">            executing the action.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">while</span> <span class="n">obeyPause</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isPaused</span><span class="p">():</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">addPostprocessorAction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="ActionPostprocessor.executeReal"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionPostprocessor.executeReal">[docs]</a>    <span class="k">def</span> <span class="nf">executeReal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Actually execute the action.</span>
<span class="sd">        </span>
<span class="sd">        If the experiment has been aborted, return. If it is paused, wait.</span>
<span class="sd">        Otherwise, execute the action, and then save the data to the file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obeyPause : bool</span>
<span class="sd">            Whether to wait until the experiment is no longer paused before</span>
<span class="sd">            executing the action.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">getFiles</span><span class="p">())</span>        
        
        </div>
<div class="viewcode-block" id="ActionPostprocessor.clone"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionPostprocessor.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Duplicate this action.</span>
<span class="sd">        </span>
<span class="sd">        Produce a new `Action` instance---with a new location in </span>
<span class="sd">        memory---which is the same as this one in all respects. This is for </span>
<span class="sd">        copy-and-paste operations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newClass</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">newClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceFile</span><span class="p">)</span>
        

<span class="c">#------------------------------------------------------------ Action - Container</span>
</div></div>
<div class="viewcode-block" id="ActionContainer"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer">[docs]</a><span class="k">class</span> <span class="nc">ActionContainer</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An abstract action which may have children.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    experiment : Experiment</span>
<span class="sd">        The `Experiment` object to which this action belongs.</span>
<span class="sd">    instrument : Instrument</span>
<span class="sd">        The `Instrument` object which will perform this action (though not</span>
<span class="sd">        necessarily its children).</span>
<span class="sd">    name : str</span>
<span class="sd">        A short name with no special characters except (possibly) an </span>
<span class="sd">        underscore, to use for looking up this action.</span>
<span class="sd">    description : str</span>
<span class="sd">        A short phrase to indicate what this action does.</span>
<span class="sd">    inputs : list of Parameter</span>
<span class="sd">        A list of `Parameter` objects which this action will pass to the</span>
<span class="sd">        instrument.</span>
<span class="sd">    outputs : list of Parameter</span>
<span class="sd">        A list of `Parameter` objects which the instrument will fill in and</span>
<span class="sd">        pass back to this action to be processed and, in most cases, written</span>
<span class="sd">        to the appropriate files.</span>
<span class="sd">    string : str</span>
<span class="sd">        A template string which can be filled in with input values to provide</span>
<span class="sd">        the user with a specific description of what this action will do.</span>
<span class="sd">    method : instancemethod</span>
<span class="sd">        The method bound to `instrument` which will actually carry out this</span>
<span class="sd">        action.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">outputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">&#39;Do nothing.&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ActionContainer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                                              <span class="n">description</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span>
                                              <span class="n">string</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="ActionContainer.setExperiment"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.setExperiment">[docs]</a>    <span class="k">def</span> <span class="nf">setExperiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newExperiment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the owner of this action, its children, and its parameters.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        newExperiment : Experiment</span>
<span class="sd">            The `Experiment` object which should own this action, its children,</span>
<span class="sd">            and its parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ActionContainer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setExperiment</span><span class="p">(</span><span class="n">newExperiment</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setExperiment</span><span class="p">(</span><span class="n">newExperiment</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ActionContainer.setStatusMonitor"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.setStatusMonitor">[docs]</a>    <span class="k">def</span> <span class="nf">setStatusMonitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newStatusMonitor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the status monitor for the action and its children.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        statusMonitor : StatusMonitor</span>
<span class="sd">            The new `StatusMonitor` object for this action.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ActionContainer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setStatusMonitor</span><span class="p">(</span><span class="n">newStatusMonitor</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setStatusMonitor</span><span class="p">(</span><span class="n">newStatusMonitor</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ActionContainer.appendChild"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.appendChild">[docs]</a>    <span class="k">def</span> <span class="nf">appendChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a child to the end of the list.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : Action</span>
<span class="sd">            The child to add to the end of the list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">child</span><span class="o">.</span><span class="n">instantiate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ActionContainer.prependChild"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.prependChild">[docs]</a>    <span class="k">def</span> <span class="nf">prependChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a child to the beginning of the list.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : Action</span>
<span class="sd">            The child to add to the beginning of the list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">child</span><span class="o">.</span><span class="n">instantiate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ActionContainer.insertChild"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.insertChild">[docs]</a>    <span class="k">def</span> <span class="nf">insertChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add an action to the list of children at a specified position.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            The position at which to add the child. If `index` is out of range,</span>
<span class="sd">            the action is appended to the list.</span>
<span class="sd">        child : Action</span>
<span class="sd">            The action to add to the list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">child</span><span class="o">.</span><span class="n">instantiate</span><span class="p">()</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ActionContainer.insertChildBefore"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.insertChildBefore">[docs]</a>    <span class="k">def</span> <span class="nf">insertChildBefore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">positionAction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Insert a child before another child.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : Action    </span>
<span class="sd">            The action which should be inserted.</span>
<span class="sd">        positionAction : Action</span>
<span class="sd">            The action before which the new child should be added. If this</span>
<span class="sd">            action does not exist, `child` will be prepended to the list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">child</span><span class="o">.</span><span class="n">instantiate</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">positionAction</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span>
</div>
<div class="viewcode-block" id="ActionContainer.insertChildAfter"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.insertChildAfter">[docs]</a>    <span class="k">def</span> <span class="nf">insertChildAfter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">positionAction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Insert a child before another child.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : Action    </span>
<span class="sd">            The action which should be inserted.</span>
<span class="sd">        positionAction : Action</span>
<span class="sd">            The action after which the new child should be added. If this</span>
<span class="sd">            action does not exist, `child` will be appended to the list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">child</span><span class="o">.</span><span class="n">instantiate</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">positionAction</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ActionContainer.replaceChild"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.replaceChild">[docs]</a>    <span class="k">def</span> <span class="nf">replaceChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Replace the child action at a given position</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            The position of the action to replace.</span>
<span class="sd">        child : Action</span>
<span class="sd">            The action which should go in the specified position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">child</span><span class="o">.</span><span class="n">instantiate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span>
</div>
<div class="viewcode-block" id="ActionContainer.setChildren"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.setChildren">[docs]</a>    <span class="k">def</span> <span class="nf">setChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replacementChildren</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Replace the list of children with a new list.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        replacementChildren : list of Action</span>
<span class="sd">            A list of actions which should be used as children of this action.</span>
<span class="sd">            It will replace any actions already considered to be children.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">replacementChildren</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">instantiate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="n">replacementChildren</span>
</div>
<div class="viewcode-block" id="ActionContainer.getChildren"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.getChildren">[docs]</a>    <span class="k">def</span> <span class="nf">getChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the list of children.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of Action</span>
<span class="sd">            The list of actions which are considered to be children of this</span>
<span class="sd">            action.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span>
</div>
<div class="viewcode-block" id="ActionContainer.removeChild"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.removeChild">[docs]</a>    <span class="k">def</span> <span class="nf">removeChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the a child action from the list.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : Action</span>
<span class="sd">            The action to remove from the list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ActionContainer.removeChildByIndex"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.removeChildByIndex">[docs]</a>    <span class="k">def</span> <span class="nf">removeChildByIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the action at the specified position.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            The position of the child to remove.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="ActionContainer.removeChildren"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.removeChildren">[docs]</a>    <span class="k">def</span> <span class="nf">removeChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Empty the list of actions.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="ActionContainer.trash"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.trash">[docs]</a>    <span class="k">def</span> <span class="nf">trash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Destroy all children, then destroy the container.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">trash</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ActionContainer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">trash</span><span class="p">()</span>


    <span class="c">#===========================================================================</span>
    <span class="c"># Execution</span>
    <span class="c">#===========================================================================</span></div>
<div class="viewcode-block" id="ActionContainer.prepareToExecute"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.prepareToExecute">[docs]</a>    <span class="k">def</span> <span class="nf">prepareToExecute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepare all children for execution.</span>
<span class="sd">        </span>
<span class="sd">        Preparing for execution means generating dictionaries for substitution</span>
<span class="sd">        into instrument methods and performing various other relevant </span>
<span class="sd">        optimization-related actions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">prepareToExecute</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ActionContainer.execute"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obeyPause</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute all children objects sequentially.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">obeyPause</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ActionContainer.executePass"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.executePass">[docs]</a>    <span class="k">def</span> <span class="nf">executePass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obeyPause</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the container using its superclass&#39;s method.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ActionContainer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">obeyPause</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ActionContainer.cleanupAfterExecution"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.cleanupAfterExecution">[docs]</a>    <span class="k">def</span> <span class="nf">cleanupAfterExecution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cleanup temporary data after execution.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">cleanupAfterExecution</span><span class="p">()</span>

    <span class="c">#===========================================================================</span>
    <span class="c"># Information strings</span>
    <span class="c">#===========================================================================</span>
</div>
<div class="viewcode-block" id="ActionContainer.getTreeString"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.getTreeString">[docs]</a>    <span class="k">def</span> <span class="nf">getTreeString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a descriptive string for the container, including children.&quot;&quot;&quot;</span>
        <span class="n">ansList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span><span class="p">(</span><span class="n">ActionContainer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">getTreeString</span><span class="p">(</span><span class="n">depth</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">ansList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">getTreeString</span><span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ansList</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ActionContainer.printme"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.printme">[docs]</a>    <span class="k">def</span> <span class="nf">printme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a descriptive string for the container, including children.&quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTreeString</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>


    <span class="c">#===========================================================================</span>
    <span class="c"># State variable commands</span>
    <span class="c">#===========================================================================</span>
</div>
<div class="viewcode-block" id="ActionContainer.clone"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionContainer.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy this action, including its children.</span>
<span class="sd">        </span>
<span class="sd">        Produce a new `Action` instance---with a new location in </span>
<span class="sd">        memory---which is the same as this one in all respects. Then do the same</span>
<span class="sd">        for all children, adding them to the new container. This is for </span>
<span class="sd">        copy-and-paste operations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newself</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ActionContainer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">newchildren</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">newchildren</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span>
        <span class="n">newself</span><span class="o">.</span><span class="n">setChildren</span><span class="p">(</span><span class="n">newchildren</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newself</span>


<span class="c"># Action - Scan ----------------------------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="ActionScan"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionScan">[docs]</a><span class="k">class</span> <span class="nc">ActionScan</span><span class="p">(</span><span class="n">ActionContainer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A action which executes other actions at multiple values of a parameter.</span>
<span class="sd">        </span>
<span class="sd">    Create a scanning action---one which executes a series of other actions</span>
<span class="sd">    (children) at each value of some varied parameter. The only input should</span>
<span class="sd">    be a list of tuples, where each tuple contains three numbers: the</span>
<span class="sd">    starting and ending bounds and step size for a scan (in that order). </span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    experiment : Experiment</span>
<span class="sd">        The `Experiment` object to which this action belongs.</span>
<span class="sd">    instrument : Instrument</span>
<span class="sd">        The `Instrument` object which will perform this action (though not</span>
<span class="sd">        necessarily its children).</span>
<span class="sd">    name : str</span>
<span class="sd">        A short name with no special characters except (possibly) an </span>
<span class="sd">        underscore, to use for looking up this action.</span>
<span class="sd">    description : str</span>
<span class="sd">        A short phrase to indicate what this action does.</span>
<span class="sd">    inputs : list of Parameter</span>
<span class="sd">        A list of `Parameter` objects which this action will pass to the</span>
<span class="sd">        instrument. For an `ActionScan`, this list should contain a single</span>
<span class="sd">        element.</span>
<span class="sd">    outputs : list of Parameter</span>
<span class="sd">        A list of `Parameter` objects which the instrument will fill in and</span>
<span class="sd">        pass back to this action to be processed and, in many cases, written</span>
<span class="sd">        to the appropriate files.</span>
<span class="sd">    string : str</span>
<span class="sd">        A template string which can be filled in with input values to provide</span>
<span class="sd">        the user with a specific description of what this action will do.</span>
<span class="sd">    method : instancemethod</span>
<span class="sd">        The method bound to `instrument` which will actually carry out this</span>
<span class="sd">        action.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">outputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">&#39;Do nothing.&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new ActionScan.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ActionScan</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                                         <span class="n">description</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span>
                                         <span class="n">method</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expandedProfile</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an informative string about the action, including ranges.</span>
<span class="sd">        </span>
<span class="sd">        Return a string describing the action and its bound instrument with all</span>
<span class="sd">        input parameters substituted. The returned string includes the initial</span>
<span class="sd">        and final points as well as the step size for each sub-range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;(disabled) &#39;</span>
        <span class="n">ans</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_templateString</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ans</span> <span class="o">+</span> <span class="s">&#39;do something, or maybe nothing.&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getFormattedValue</span><span class="p">()</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_templateString</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">+</span> <span class="s">&#39; from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s"> in steps of </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">value</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">+</span> <span class="s">&#39; and&#39;</span>
        <span class="k">return</span> <span class="n">ans</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span>

<div class="viewcode-block" id="ActionScan.prepareToExecute"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionScan.prepareToExecute">[docs]</a>    <span class="k">def</span> <span class="nf">prepareToExecute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepare the ActionScan to execute by expanding the range.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expandedProfile</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">inputParameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">profiles</span> <span class="o">=</span> <span class="n">inputParameter</span><span class="o">.</span><span class="n">value</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">profile</span> <span class="ow">in</span> <span class="n">profiles</span><span class="p">:</span>
            <span class="n">initial</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">final</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">dif</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">final</span> <span class="o">-</span> <span class="n">initial</span><span class="p">)</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">dif</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">profile</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">same</span> <span class="o">=</span> <span class="n">ActionScan</span><span class="o">.</span><span class="n">zeroWithinTolerance</span><span class="p">(</span><span class="n">dif</span><span class="p">,</span> <span class="n">TOLERANCE</span><span class="p">)</span>
            <span class="n">nostep</span> <span class="o">=</span> <span class="n">ActionScan</span><span class="o">.</span><span class="n">zeroWithinTolerance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">TOLERANCE</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">same</span> <span class="ow">or</span> <span class="n">nostep</span><span class="p">:</span>
                <span class="n">rng</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rng</span> <span class="o">=</span> <span class="n">gentools</span><span class="o">.</span><span class="n">frange</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">final</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">steps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
            <span class="n">subParameter</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="p">,</span>
                                     <span class="n">inputParameter</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                     <span class="n">inputParameter</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                                     <span class="n">inputParameter</span><span class="o">.</span><span class="n">formatString</span><span class="p">,</span>
                                     <span class="n">inputParameter</span><span class="o">.</span><span class="n">binName</span><span class="p">,</span>
                                     <span class="n">inputParameter</span><span class="o">.</span><span class="n">binType</span><span class="p">,</span>
                                     <span class="n">step</span><span class="p">)</span>
            <span class="n">stepString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_templateString</span> <span class="o">+</span> <span class="s">&#39; At &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">subParameter</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span>
            <span class="n">subAction</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">,</span> <span class="p">[</span><span class="n">subParameter</span><span class="p">],</span> <span class="p">[],</span>
                               <span class="n">stepString</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expandedProfile</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subAction</span><span class="p">)</span>
            <span class="n">subAction</span><span class="o">.</span><span class="n">prepareToExecute</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ActionScan</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">prepareToExecute</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ActionScan.execute"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionScan.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obeyPause</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the ActionScan.</span>
<span class="sd">        </span>
<span class="sd">        Expand the scans into the individual values for which the action&#39;s</span>
<span class="sd">        method will be executed, and then execute the method with each of those</span>
<span class="sd">        values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="k">while</span> <span class="n">obeyPause</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isPaused</span><span class="p">():</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expandedProfile</span><span class="p">:</span>
            <span class="n">action</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">obeyPause</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ActionScan.cleanupAfterExecution"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionScan.cleanupAfterExecution">[docs]</a>    <span class="k">def</span> <span class="nf">cleanupAfterExecution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cleanup temporary data after execution.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expandedProfile</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ActionScan</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">cleanupAfterExecution</span><span class="p">()</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ActionScan.zeroWithinTolerance"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionScan.zeroWithinTolerance">[docs]</a>    <span class="k">def</span> <span class="nf">zeroWithinTolerance</span><span class="p">(</span><span class="n">dif</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether a number is small enough to be treated as zero.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dif : float</span>
<span class="sd">            The number to compare to zero.</span>
<span class="sd">        tolerance : float</span>
<span class="sd">            The maximum difference between two numbers for them to be called</span>
<span class="sd">            equal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dif</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dif</span><span class="p">))</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tolerance</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dif</span> <span class="o">&lt;</span> <span class="n">tol</span>


<span class="c"># Action - Loop - By Time ------------------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="ActionLoopTimed"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopTimed">[docs]</a><span class="k">class</span> <span class="nc">ActionLoopTimed</span><span class="p">(</span><span class="n">ActionContainer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A container which repeats its children for a specified length of time.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    experiment : Experiment</span>
<span class="sd">        The `Experiment` instance which owns this loop.</span>
<span class="sd">    instrument : Instrument</span>
<span class="sd">        The `Instrument` which will carry out this action.</span>
<span class="sd">    name : str</span>
<span class="sd">        A short name with no special characters except (possibly) an </span>
<span class="sd">        underscore, to use for looking up this action.</span>
<span class="sd">    description : str</span>
<span class="sd">        A short phrase to indicate what this action does.</span>
<span class="sd">    duration : float </span>
<span class="sd">        The amount of time, in seconds, after which the loop should stop.</span>
<span class="sd">        </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    At the end of each cycle, the system determines how much time has elapsed.</span>
<span class="sd">    If the time elapsed is greater than or equal to the specified time, the</span>
<span class="sd">    loop is interrupted and the sequence resumes. Therefore, it is possible</span>
<span class="sd">    (and even likely) that the loop will run somewhat longer than specified. </span>
<span class="sd">    Precisely how much longer will be determined by the run time of the </span>
<span class="sd">    children.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new timed action loop.&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ActionLoopTimed</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                                              <span class="n">description</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span> <span class="o">=</span> <span class="n">duration</span>

<div class="viewcode-block" id="ActionLoopTimed.getDuration"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopTimed.getDuration">[docs]</a>    <span class="k">def</span> <span class="nf">getDuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the time after which the loop will stop.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The time, in seconds, after which the loop will stop running.</span>
<span class="sd">            Depending on the run time of the children, the loop may run longer</span>
<span class="sd">            than the specified time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span>
</div>
<div class="viewcode-block" id="ActionLoopTimed.setDuration"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopTimed.setDuration">[docs]</a>    <span class="k">def</span> <span class="nf">setDuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set how long the loop should run.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        duration : float</span>
<span class="sd">            The length of time after which the loop will stop running. The</span>
<span class="sd">            loop may run longer than the specified time, depending on the run</span>
<span class="sd">            time of the children. But after the specified time, no new </span>
<span class="sd">            iterations of the loop will be started.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span> <span class="o">=</span> <span class="n">duration</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an informative string about the action.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A string describing this action and the instrument which is bound</span>
<span class="sd">            to it, substituting all relevant settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;(disabled) &#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ans</span> <span class="o">+</span> <span class="s">&#39;Execute the following actions for </span><span class="si">%.3f</span><span class="s"> s.&#39;</span> <span class="o">%</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span><span class="p">)</span>

<div class="viewcode-block" id="ActionLoopTimed.execute"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopTimed.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obeyPause</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the loop action.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="k">while</span> <span class="n">obeyPause</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isPaused</span><span class="p">():</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="n">startTime</span> <span class="o">=</span> <span class="n">clock</span><span class="p">()</span>
        <span class="n">currTime</span> <span class="o">=</span> <span class="n">startTime</span>
        <span class="k">while</span> <span class="n">currTime</span> <span class="o">-</span> <span class="n">startTime</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Looping: </span><span class="si">%.3f</span><span class="s"> s of </span><span class="si">%.3f</span><span class="s"> s elapsed&#39;</span><span class="p">,</span>
                          <span class="n">currTime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">():</span>
                <span class="n">child</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">obeyPause</span><span class="p">)</span>
            <span class="n">currTime</span> <span class="o">=</span> <span class="n">clock</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ActionLoopTimed.clone"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopTimed.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of this action.&quot;&quot;&quot;</span>
        <span class="n">newSelf</span> <span class="o">=</span> <span class="n">ActionLoopTimed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span><span class="p">)</span>
        <span class="n">newChildren</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">newChildren</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span>
        <span class="n">newSelf</span><span class="o">.</span><span class="n">setChildren</span><span class="p">(</span><span class="n">newChildren</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newSelf</span>


<span class="c"># Action - Loop - Number of Iterations -----------------------------------------</span>
</div></div>
<div class="viewcode-block" id="ActionLoopIterations"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopIterations">[docs]</a><span class="k">class</span> <span class="nc">ActionLoopIterations</span><span class="p">(</span><span class="n">ActionContainer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A container which repeats its children a specified number of times.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    experiment : Experiment</span>
<span class="sd">        The `Experiment` instance which owns this loop.</span>
<span class="sd">    instrument : Instrument</span>
<span class="sd">        The `Instrument` which will carry out the action (though not necessarily</span>
<span class="sd">        its children).</span>
<span class="sd">    name : str</span>
<span class="sd">        A short name with no special characters except (possibly) an </span>
<span class="sd">        underscore, to use for looking up this action.</span>
<span class="sd">    description : str</span>
<span class="sd">        A short phrase to indicate what this action does.</span>
<span class="sd">    iterations : int </span>
<span class="sd">        The number of times the children should be executed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new iterations-based action loop.&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ActionLoopIterations</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                                                   <span class="n">description</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_iterations</span> <span class="o">=</span> <span class="n">iterations</span>

<div class="viewcode-block" id="ActionLoopIterations.getIterations"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopIterations.getIterations">[docs]</a>    <span class="k">def</span> <span class="nf">getIterations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the number of times the loop&#39;s children will be executed.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The number of times the children will be executed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterations</span>
</div>
<div class="viewcode-block" id="ActionLoopIterations.setIterations"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopIterations.setIterations">[docs]</a>    <span class="k">def</span> <span class="nf">setIterations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set how long the loop should run.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        iterations : int</span>
<span class="sd">            The number of times the children should be executed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iterations</span> <span class="o">=</span> <span class="n">iterations</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an informative string about the action.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A string describing this action and the instrument which is bound</span>
<span class="sd">            to it, substituting all relevant settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;(disabled) &#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ans</span> <span class="o">+</span> <span class="s">&#39;Execute the following actions </span><span class="si">%d</span><span class="s"> times.&#39;</span> <span class="o">%</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_iterations</span><span class="p">)</span>

<div class="viewcode-block" id="ActionLoopIterations.execute"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopIterations.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obeyPause</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the loop action.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="k">while</span> <span class="n">obeyPause</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isPaused</span><span class="p">():</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iterations</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Looping: </span><span class="si">%d</span><span class="s"> of </span><span class="si">%d</span><span class="s"> iterations completed.&#39;</span><span class="p">,</span>
                          <span class="n">cycle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterations</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">obeyPause</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ActionLoopIterations.clone"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopIterations.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of this action.&quot;&quot;&quot;</span>
        <span class="n">newSelf</span> <span class="o">=</span> <span class="n">ActionLoopIterations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterations</span><span class="p">)</span>
        <span class="n">newChildren</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">newChildren</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span>
        <span class="n">newSelf</span><span class="o">.</span><span class="n">setChildren</span><span class="p">(</span><span class="n">newChildren</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newSelf</span>


<span class="c"># Action - Loop - Conditional --------------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="ActionLoopWhile"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopWhile">[docs]</a><span class="k">class</span> <span class="nc">ActionLoopWhile</span><span class="p">(</span><span class="n">ActionContainer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A container which repeats its children a specified number of times.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    experiment : Experiment</span>
<span class="sd">        The `Experiment` instance which owns this loop.</span>
<span class="sd">    instrument : Instrument</span>
<span class="sd">        The `Instrument` which will carry out the action (though not necessarily</span>
<span class="sd">        its children).</span>
<span class="sd">    name : str</span>
<span class="sd">        A short name with no special characters except (possibly) an </span>
<span class="sd">        underscore, to use for looking up this action.</span>
<span class="sd">    description : str</span>
<span class="sd">        A short phrase to indicate what this action does.</span>
<span class="sd">    expression : str</span>
<span class="sd">        An expression which can evaluate to a boolean. The loop continues</span>
<span class="sd">        as long as `expression` evaluates to `True`.</span>
<span class="sd">    timeout : float</span>
<span class="sd">        The maximum amount of time, in seconds, to wait for the expression</span>
<span class="sd">        to evaluate to `True`. If `timeout` is set to `None`, the loop will</span>
<span class="sd">        run until `expression` becomes false or until the experiment is</span>
<span class="sd">        aborted.</span>
<span class="sd">        </span>
<span class="sd">        This is a fail-safe to prevent infinite loops (for example, if you set</span>
<span class="sd">        it to run until a desired temperature is reached, but the cryostat</span>
<span class="sd">        is unable to reach that temperature).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span>
                 <span class="n">timeout</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new conditional (while) loop.&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ActionLoopWhile</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                                              <span class="n">description</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span> <span class="o">=</span> <span class="n">expression</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="o">=</span> <span class="n">timeout</span>

<div class="viewcode-block" id="ActionLoopWhile.getExpression"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopWhile.getExpression">[docs]</a>    <span class="k">def</span> <span class="nf">getExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the conditional which determines the number of iterations.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The expression which will be evaluated to a boolean value to</span>
<span class="sd">            determine whether to keep looping. If it evaluates to `True`, the</span>
<span class="sd">            loop continues. Otherwise, it terminates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span>
</div>
<div class="viewcode-block" id="ActionLoopWhile.setExpression"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopWhile.setExpression">[docs]</a>    <span class="k">def</span> <span class="nf">setExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the conditional expression which determines when to stop.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expression : str</span>
<span class="sd">            The expression which will be evaluated to a boolean value to</span>
<span class="sd">            determine whether to keep looping. If it evaluates to `True`, the</span>
<span class="sd">            loop continues. Otherwise, it terminates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span> <span class="o">=</span> <span class="n">expression</span>
</div>
<div class="viewcode-block" id="ActionLoopWhile.getTimeout"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopWhile.getTimeout">[docs]</a>    <span class="k">def</span> <span class="nf">getTimeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the maximum time to wait for the condition to become `False`.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The maximum time in seconds that the system will wait for the</span>
<span class="sd">            condition to return `False`. If it is set to `None`, the loop</span>
<span class="sd">            will run until the condition returns `False` or until the</span>
<span class="sd">            experiment is aborted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span>
</div>
<div class="viewcode-block" id="ActionLoopWhile.setTimeout"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopWhile.setTimeout">[docs]</a>    <span class="k">def</span> <span class="nf">setTimeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the maximum time to wait for the condition to become false.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        timeout : float</span>
<span class="sd">            The maximum time in seconds that the system will wait for the</span>
<span class="sd">            condition to return `False`. If it is set to `None`, the loop</span>
<span class="sd">            will run until the condition returns `False` or until the</span>
<span class="sd">            experiment is aborted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="o">=</span> <span class="n">timeout</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an informative string about the action.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A string describing this action and the instrument which is bound</span>
<span class="sd">            to it, substituting all relevant settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;(disabled) &#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">ans</span> <span class="o">+</span> <span class="s">&#39;Execute the following actions while [</span><span class="si">%s</span><span class="s">] is True.&#39;</span>
                            <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ans</span> <span class="o">+</span> <span class="s">&#39;Execute the following actions while [</span><span class="si">%s</span><span class="s">] is True. &#39;</span> <span class="o">+</span>
                <span class="s">&#39;Timeout=</span><span class="si">%.3f</span><span class="s">s&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">)</span>

<div class="viewcode-block" id="ActionLoopWhile.execute"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopWhile.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obeyPause</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the loop action.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="k">while</span> <span class="n">obeyPause</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isPaused</span><span class="p">():</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="n">startTime</span> <span class="o">=</span> <span class="n">clock</span><span class="p">()</span>
        <span class="n">maxtime</span> <span class="o">=</span> <span class="n">startTime</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">evaluateConditional</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">,</span> <span class="bp">True</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">():</span>
                <span class="n">child</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">obeyPause</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">clock</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">maxtime</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Loop timed out for expression [</span><span class="si">%s</span><span class="s">].&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">)</span>
                <span class="k">break</span>
</div>
<div class="viewcode-block" id="ActionLoopWhile.clone"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopWhile.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of this action.&quot;&quot;&quot;</span>
        <span class="n">newSelf</span> <span class="o">=</span> <span class="n">ActionLoopWhile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">)</span>
        <span class="n">newChildren</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">newChildren</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span>
        <span class="n">newSelf</span><span class="o">.</span><span class="n">setChildren</span><span class="p">(</span><span class="n">newChildren</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newSelf</span>


<span class="c">#---------------------------------------------- Action - Loop - Manual Interrupt</span>
</div></div>
<div class="viewcode-block" id="ActionLoopUntilInterrupt"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopUntilInterrupt">[docs]</a><span class="k">class</span> <span class="nc">ActionLoopUntilInterrupt</span><span class="p">(</span><span class="n">ActionContainer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A container to execute its children until manually interrupted.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    experiment : Experiment</span>
<span class="sd">        The `Experiment` instance which owns this loop.</span>
<span class="sd">    instrument : Instrument</span>
<span class="sd">        The `Instrument` which will carry out this action.</span>
<span class="sd">    name : str</span>
<span class="sd">        A short name with no special characters except (possibly) an </span>
<span class="sd">        underscore, to use for looking up this action.</span>
<span class="sd">    description : str</span>
<span class="sd">        A short phrase to indicate what this action does.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new indefinitely-running loop.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ActionLoopUntilInterrupt</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span>
                                                       <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_loopEnterCommands</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loopExitCommands</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="ActionLoopUntilInterrupt.setLoopCommands"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopUntilInterrupt.setLoopCommands">[docs]</a>    <span class="k">def</span> <span class="nf">setLoopCommands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loopEnterCommands</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">loopExitCommands</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the commands to execute when the loop begins and finishes.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loopEnterCommands : list of Command</span>
<span class="sd">            The `Command` objects to execute before any other actions when the</span>
<span class="sd">            sequence enters the loop.</span>
<span class="sd">        loopExitCommands : list of Command</span>
<span class="sd">            The `Command` objects to execute after any other actions when the</span>
<span class="sd">            loop has been interrupted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">loopEnterCommands</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loopEnterCommands</span> <span class="o">=</span> <span class="n">loopEnterCommands</span>
        <span class="k">if</span> <span class="n">loopExitCommands</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loopExitCommands</span> <span class="o">=</span> <span class="n">loopExitCommands</span>

</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an informative string about the action.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A string describing this action and the instrument which is bound</span>
<span class="sd">            to it, substituting all relevant settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;(disabled) &#39;</span>
        <span class="k">return</span> <span class="n">ans</span> <span class="o">+</span> <span class="s">&#39;Repeat the following actions until interrupted.&#39;</span>

<div class="viewcode-block" id="ActionLoopUntilInterrupt.execute"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopUntilInterrupt.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obeyPause</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the loop action.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="k">while</span> <span class="n">obeyPause</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isPaused</span><span class="p">():</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loopEnterCommands</span><span class="p">:</span>
            <span class="n">command</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Looping: wait for user interrupt.&#39;</span><span class="p">)</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isRunning</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isInterrupted</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Still looping.&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">():</span>
                <span class="n">child</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">obeyPause</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Loop interrupted.&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loopExitCommands</span><span class="p">:</span>
            <span class="n">command</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ActionLoopUntilInterrupt.clone"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionLoopUntilInterrupt.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of this action.&quot;&quot;&quot;</span>
        <span class="n">newSelf</span> <span class="o">=</span> <span class="n">ActionLoopUntilInterrupt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">)</span>
        <span class="n">newChildren</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">newChildren</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span>
        <span class="n">newSelf</span><span class="o">.</span><span class="n">setChildren</span><span class="p">(</span><span class="n">newChildren</span><span class="p">)</span>

        <span class="n">newSelf</span><span class="o">.</span><span class="n">setLoopCommands</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loopEnterCommands</span><span class="p">),</span>
                                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loopExitCommands</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">newSelf</span>
</div>
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the enter/exit commands from the list.&quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&#39;BLAH BLAH&#39;</span>
        <span class="n">odict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_loopEnterCommands&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_loopExitCommands&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_statusMonitor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">del</span> <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_method&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">odict</span>


<span class="c">#--------------------------------------------------- Action - Simultaneous block</span>
</div>
<div class="viewcode-block" id="ActionSimultaneous"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionSimultaneous">[docs]</a><span class="k">class</span> <span class="nc">ActionSimultaneous</span><span class="p">(</span><span class="n">ActionContainer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A container which executes all of its children in parallel.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    experiment : Experiment</span>
<span class="sd">        The `Experiment` object which owns this action container.</span>
<span class="sd">    instrument : Instrument</span>
<span class="sd">        The `Instrument` which will perform this action.</span>
<span class="sd">    name : str</span>
<span class="sd">        A short name with no special characters except (possibly) an </span>
<span class="sd">        underscore, to use for looking up this action.</span>
<span class="sd">    description : str</span>
<span class="sd">        A short phrase to indicate what this action does.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a simultaneous action block.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ActionSimultaneous</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span>
                                                 <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an informative string about the action.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A string describing this action and the instrument which is bound</span>
<span class="sd">            to it, substituting all relevant settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="s">&#39;(disabled) &#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ans</span> <span class="o">+</span> <span class="s">&#39;Begin executing all of the following actions at &#39;</span> <span class="o">+</span>
                <span class="s">&#39;the same time.&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="ActionSimultaneous.execute"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionSimultaneous.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obeyPause</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the children simultaneously.</span>
<span class="sd">        </span>
<span class="sd">        If the experiment has been stopped, return. If the experiment is paused,</span>
<span class="sd">        wait until it is not. Otherwise, create threads for all of the action&#39;s</span>
<span class="sd">        children. Then tell the `Experiment` to activate the temporary</span>
<span class="sd">        buffer for storing the data. Then start the threads, and wait for them</span>
<span class="sd">        to finish. Finally, tell the `Experiment` that the simultaneously-</span>
<span class="sd">        running actions are finished so that it will save the data and empty</span>
<span class="sd">        the buffer.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obeyPause : bool</span>
<span class="sd">            The indication of whether the action should wait if the experiment</span>
<span class="sd">            is paused.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="k">while</span> <span class="n">obeyPause</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">isPaused</span><span class="p">():</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">thread</span> <span class="o">=</span> <span class="n">ActionThread</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">obeyPause</span><span class="p">)</span>
            <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">activateTemporaryBuffer</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="o">.</span><span class="n">deactivateTemporaryBuffer</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="ActionSimultaneous.clone"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionSimultaneous.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of this action.&quot;&quot;&quot;</span>
        <span class="n">newSelf</span> <span class="o">=</span> <span class="n">ActionSimultaneous</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">)</span>
        <span class="n">newChildren</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">newChildren</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span>
        <span class="n">newSelf</span><span class="o">.</span><span class="n">setChildren</span><span class="p">(</span><span class="n">newChildren</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newSelf</span>


<span class="c">#--------------------------------------------------------------------- Parameter</span>
</div></div>
<div class="viewcode-block" id="Parameter"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Parameter">[docs]</a><span class="k">class</span> <span class="nc">Parameter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An input/output and information to identify, format, and describe it.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    experiment : Experiment</span>
<span class="sd">        The `Experiment` object which owns the `Action` for which this is a</span>
<span class="sd">        parameter.</span>
<span class="sd">    name : str</span>
<span class="sd">        A short, one-word name used for substitutions into the `Action` object&#39;s</span>
<span class="sd">        descriptive template string.</span>
<span class="sd">    description : str</span>
<span class="sd">        A relatively short phrase describing the purpose of this parameter.</span>
<span class="sd">    formatString : str</span>
<span class="sd">        A standardized string indicating how values should be formated (e.g.,</span>
<span class="sd">        &quot;%.3e&quot; for an exponential-format number with three decimal places).</span>
<span class="sd">        If this parameter represents a scan profile, the formatString should</span>
<span class="sd">        end with &#39;[]&#39;.</span>
<span class="sd">    binName : str</span>
<span class="sd">        The default name of the data column or parameter slot into which</span>
<span class="sd">        this parameter&#39;s data should be saved.</span>
<span class="sd">    binType : str</span>
<span class="sd">        The default **type** of slot for saving data. It may be &#39;column&#39;,</span>
<span class="sd">        &#39;parameter&#39;, if the data is not to be saved by default, or `None` or &#39;&#39;.</span>
<span class="sd">    value : various</span>
<span class="sd">        The default value of the parameter. Its type depends on the parameter</span>
<span class="sd">        (it could be a floating-point number, an integer, a boolean, a string,</span>
<span class="sd">        or a list of 3-tuples of integers or floats).</span>
<span class="sd">    allowed : list of str</span>
<span class="sd">        A list of strings representing the allowed values for the parameter. If</span>
<span class="sd">        it is `None`, any type-appropriate value will be accepted.</span>
<span class="sd">    instantiate : bool</span>
<span class="sd">        Whether to immediately alter the experiment&#39;s column or parameter</span>
<span class="sd">        database.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">formatString</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.6e</span><span class="s">&#39;</span><span class="p">,</span>
                 <span class="n">binName</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">binType</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">allowed</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">instantiate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">isScan</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new parameter.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expt</span> <span class="o">=</span> <span class="n">experiment</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">instantiated</span> <span class="o">=</span> <span class="n">instantiate</span>
        <span class="k">if</span> <span class="n">instantiate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__binName</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binType</span> <span class="o">=</span> <span class="n">binType</span>
            <span class="k">if</span> <span class="n">binName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binName</span> <span class="o">=</span> <span class="n">binName</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__binName</span> <span class="o">=</span> <span class="n">binName</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binType</span> <span class="o">=</span> <span class="n">binType</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">formatString</span> <span class="o">=</span> <span class="n">formatString</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isScanProfile</span> <span class="o">=</span> <span class="n">isScan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span> <span class="o">=</span> <span class="nb">str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_establishCoersion</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__allowedValues</span> <span class="o">=</span> <span class="n">allowed</span>


    <span class="c">#===========================================================================</span>
    <span class="c"># Data storage bin control</span>
    <span class="c">#===========================================================================</span>

<div class="viewcode-block" id="Parameter.instantiate"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Parameter.instantiate">[docs]</a>    <span class="k">def</span> <span class="nf">instantiate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Instantiate the parameter.</span>
<span class="sd">        </span>
<span class="sd">        If this method has not been run previously, set the bin names using the</span>
<span class="sd">        method (as opposed to simply changing the value of the variable), which</span>
<span class="sd">        passes the name change to the experiment to update the data storage</span>
<span class="sd">        dictionaries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">instantiated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instantiated</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">tempname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binName</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__binName</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binName</span> <span class="o">=</span> <span class="n">tempname</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">binName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the name of the storage bin.</span>
<span class="sd">        </span>
<span class="sd">        If the value is to be stored in a column, return the column name simply.</span>
<span class="sd">        If it is to be stored as a parameter, return the parameter name prefixed</span>
<span class="sd">        by the _PARAM_. Return `None` if the data is not to be saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">binType</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">binType</span> <span class="o">==</span> <span class="s">&#39;parameter&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PARAM_ID</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binName</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binName</span>
    <span class="nd">@binName.setter</span>
<div class="viewcode-block" id="Parameter.binName"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Parameter.binName">[docs]</a>    <span class="k">def</span> <span class="nf">binName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the name of the relevant storage bin.</span>
<span class="sd">        </span>
<span class="sd">        Set the name and type of the storage bin associated with this</span>
<span class="sd">        parameter. Then update the owning experiment accordingly.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        newName : str</span>
<span class="sd">            The desired name for the storage bin associated with this</span>
<span class="sd">            parameter. If it starts with `PARAM_ID` (which is currently the</span>
<span class="sd">            dollar sign), the bin type will be set to &#39;parameter&#39; and the</span>
<span class="sd">            leading `PARAM_ID` will be removed. Otherwise, the bin type</span>
<span class="sd">            will be set to &#39;column&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">oldname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binName</span>
        <span class="n">oldtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binType</span>
        <span class="k">if</span> <span class="n">newName</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">newName</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__binName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binType</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="n">newName</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">PARAM_ID</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__binName</span> <span class="o">=</span> <span class="n">newName</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">PARAM_ID</span><span class="p">):]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binType</span> <span class="o">=</span> <span class="s">&#39;parameter&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__binName</span> <span class="o">=</span> <span class="n">newName</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binType</span> <span class="o">=</span> <span class="s">&#39;column&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instantiated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expt</span><span class="o">.</span><span class="n">handleStorageBins</span><span class="p">(</span><span class="n">oldname</span><span class="p">,</span> <span class="n">oldtype</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">__binName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binType</span><span class="p">)</span>

    <span class="c">#===========================================================================</span>
    <span class="c"># Data values</span>
    <span class="c">#===========================================================================</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of the value of the parameter.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isScanProfile</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__value</span>
    <span class="nd">@value.setter</span>
<div class="viewcode-block" id="Parameter.value"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Parameter.value">[docs]</a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newValue</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the value of the parameter.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        newValue</span>
<span class="sd">            The value to which the parameter should be set. Depending on the</span>
<span class="sd">            context, it might be a str, an int, a float, or a list.</span>
<span class="sd">            </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidInputError</span>
<span class="sd">            An error to indicate that `newValue` cannot be cast to the type</span>
<span class="sd">            this parameter is expecting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">newValue</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">),</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInputError</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">newValue</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a string representing the formatted value of the parameter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatString</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__value</span>

<div class="viewcode-block" id="Parameter.getFormattedValue"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Parameter.getFormattedValue">[docs]</a>    <span class="k">def</span> <span class="nf">getFormattedValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value formatted as a string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isScanProfile</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__value</span><span class="p">:</span>
                <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">formatString</span> <span class="o">%</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">formatString</span> <span class="o">%</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">formatString</span> <span class="o">%</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">ans</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Parameter.saveData"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Parameter.saveData">[docs]</a>    <span class="k">def</span> <span class="nf">saveData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the parameter to the relevant file (data or parameter).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expt</span><span class="o">.</span><span class="n">saveData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binName</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Parameter.allowedValues"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Parameter.allowedValues">[docs]</a>    <span class="k">def</span> <span class="nf">allowedValues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of the list of allowed values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__allowedValues</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__allowedValues</span><span class="p">)</span>


    <span class="c">#===========================================================================</span>
    <span class="c"># Comparison and state variable commands</span>
    <span class="c">#===========================================================================</span>
</div>
    <span class="k">def</span> <span class="nf">_establishCoersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create the coerce method to get input values to be the right type.&quot;&quot;&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;%[-+0]{0,3}\d*\.?\d*(\w)&#39;</span><span class="p">)</span>
        <span class="n">typeStringMatch</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formatString</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">typeStringMatch</span><span class="p">:</span>
            <span class="n">typeString</span> <span class="o">=</span> <span class="n">typeStringMatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">typeString</span> <span class="o">==</span> <span class="s">&#39;e&#39;</span> <span class="ow">or</span> <span class="n">typeString</span> <span class="o">==</span> <span class="s">&#39;E&#39;</span> <span class="ow">or</span> <span class="n">typeString</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span> <span class="o">=</span> <span class="nb">float</span>
            <span class="k">elif</span> <span class="n">typeString</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">typeString</span> <span class="o">==</span> <span class="s">&#39;i&#39;</span> <span class="ow">or</span> <span class="n">typeString</span> <span class="o">==</span> <span class="s">&#39;u&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span> <span class="o">=</span> <span class="nb">int</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span> <span class="o">=</span> <span class="nb">str</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isScanProfile</span><span class="p">:</span>
            <span class="n">oldcoerce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span>
            <span class="k">def</span> <span class="nf">listCoerce</span><span class="p">(</span><span class="n">profile</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;Helper for coercing lists.&quot;&quot;&quot;</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">profile</span><span class="p">:</span>
                    <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">oldcoerce</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                <span class="n">oldcoerce</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                <span class="n">oldcoerce</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
                <span class="k">return</span> <span class="n">ans</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span> <span class="o">=</span> <span class="n">listCoerce</span>

<div class="viewcode-block" id="Parameter.clone"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Parameter.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of this parameter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expt</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">formatString</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">__binName</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">binType</span><span class="p">,</span>
                         <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__value</span><span class="p">),</span>
                         <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__allowedValues</span><span class="p">),</span>
                         <span class="bp">False</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">isScanProfile</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Parameter.getXML"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.Parameter.getXML">[docs]</a>    <span class="k">def</span> <span class="nf">getXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an XML string representing the parameter.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A string containing XML data representing all of the data related</span>
<span class="sd">            to the parameter, possibly useful as an alternative to pickle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">indent</span> <span class="o">+</span> <span class="s">&#39;&lt;actionparameter name=&quot;</span><span class="si">%s</span><span class="s">&quot; value=&quot;</span><span class="si">%s</span><span class="s">&quot; &#39;</span>
                <span class="s">&#39;bin_name=&quot;</span><span class="si">%s</span><span class="s">&quot; bin_type=&quot;</span><span class="si">%s</span><span class="s">&quot; /&gt;&#39;</span> <span class="o">%</span> 
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">escapeXML</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__value</span><span class="p">)),</span> 
                 <span class="n">escapeXML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__binName</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">binType</span><span class="p">))</span>
        </div>
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the method reference for pickling purposes.&quot;&quot;&quot;</span>
        <span class="n">odict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">odict</span><span class="p">[</span><span class="s">&#39;coerce&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">odict</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reinstate the method reference after loading from a file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_establishCoersion</span><span class="p">()</span>


<span class="c">#---------------------------------------------------- Action and Parameter Specs</span>
</div>
<span class="n">ActionSpec</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;ActionSpec&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;cls&#39;</span><span class="p">,</span> <span class="s">&#39;args&#39;</span><span class="p">])</span>
<span class="n">ParameterSpec</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;ParameterSpec&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;args&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="constructAction"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.constructAction">[docs]</a><span class="k">def</span> <span class="nf">constructAction</span><span class="p">(</span><span class="n">actionSpec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Construct an action from an action specification.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    actionSpec : ActionSpec</span>
<span class="sd">        An instance of the `namedtuple` class `ActionSpec`.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Action</span>
<span class="sd">        The instance of `Action` or one of its subclasses specified by</span>
<span class="sd">        `actionSpec`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newArgs</span> <span class="o">=</span> <span class="n">actionSpec</span><span class="o">.</span><span class="n">args</span>
    <span class="n">newArgs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">actionSpec</span><span class="o">.</span><span class="n">name</span>
    <span class="n">isScan</span> <span class="o">=</span> <span class="n">actionSpec</span><span class="o">.</span><span class="n">cls</span> <span class="o">==</span> <span class="n">ActionScan</span>
    <span class="k">if</span> <span class="s">&#39;inputs&#39;</span> <span class="ow">in</span> <span class="n">newArgs</span><span class="p">:</span>
        <span class="n">newInputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">inputItem</span> <span class="ow">in</span> <span class="n">newArgs</span><span class="p">[</span><span class="s">&#39;inputs&#39;</span><span class="p">]:</span>
            <span class="n">newInputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constructParameter</span><span class="p">(</span><span class="n">inputItem</span><span class="p">,</span> <span class="n">isScan</span><span class="p">))</span>
        <span class="n">newArgs</span><span class="p">[</span><span class="s">&#39;inputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newInputs</span>
    <span class="k">if</span> <span class="s">&#39;outputs&#39;</span> <span class="ow">in</span> <span class="n">newArgs</span><span class="p">:</span>
        <span class="n">newOutputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">outputItem</span> <span class="ow">in</span> <span class="n">newArgs</span><span class="p">[</span><span class="s">&#39;outputs&#39;</span><span class="p">]:</span>
            <span class="n">newOutputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constructParameter</span><span class="p">(</span><span class="n">outputItem</span><span class="p">,</span> <span class="n">isScan</span><span class="p">))</span>
        <span class="n">newArgs</span><span class="p">[</span><span class="s">&#39;outputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newOutputs</span>

    <span class="k">return</span> <span class="n">actionSpec</span><span class="o">.</span><span class="n">cls</span><span class="p">(</span><span class="o">**</span><span class="n">newArgs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="constructParameter"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.constructParameter">[docs]</a><span class="k">def</span> <span class="nf">constructParameter</span><span class="p">(</span><span class="n">parameterSpec</span><span class="p">,</span> <span class="n">isScan</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Construct a parameter from a parameter specification.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameterSpec : ParameterSpec</span>
<span class="sd">        An instance of the `namedtuple` class `ParameterSpec`.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Parameter</span>
<span class="sd">        The instance of `Parameter` specified by `parameterSpec`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parameterSpec</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="p">[(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">parameterSpec</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                                         <span class="p">(</span><span class="s">&#39;isScan&#39;</span><span class="p">,</span> <span class="n">isScan</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">Parameter</span><span class="p">(</span><span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>


<span class="c">#------------------------------------------------------------- Utility Functions</span>
</div>
<div class="viewcode-block" id="nullFunction"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.nullFunction">[docs]</a><span class="k">def</span> <span class="nf">nullFunction</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Do nothing.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="cloneParameterList"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.cloneParameterList">[docs]</a><span class="k">def</span> <span class="nf">cloneParameterList</span><span class="p">(</span><span class="n">parameterList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clone a list of input or output parameters.&quot;&quot;&quot;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">parameterList</span><span class="p">:</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">ans</span>
</div>
<div class="viewcode-block" id="coerceIntThroughFloat"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.coerceIntThroughFloat">[docs]</a><span class="k">def</span> <span class="nf">coerceIntThroughFloat</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a number to a float and then to an int.</span>
<span class="sd">    </span>
<span class="sd">    Certain kinds of string literals cannot be cast directly to integers. This</span>
<span class="sd">    function takes such a string and converts it to a float and then to an</span>
<span class="sd">    integer.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    number : str</span>
<span class="sd">        A string containing a number which should be cast to an integer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>


<span class="c">#----------------------------------------------------------------- Action Thread</span>
</div>
<div class="viewcode-block" id="ActionThread"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionThread">[docs]</a><span class="k">class</span> <span class="nc">ActionThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A thread for executing sub-actions without blocking.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">obeyPause</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new thread for executing an action.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ActionThread</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obeyPause</span> <span class="o">=</span> <span class="n">obeyPause</span>

<div class="viewcode-block" id="ActionThread.run"><a class="viewcode-back" href="../../../api_core_action.html#src.core.action.ActionThread.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the action.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obeyPause</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Transport Experiment 1.5.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Thomas C. Flanagan.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>