

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>src.core.experiment &mdash; Transport Experiment 1.5.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Transport Experiment 1.5.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Transport Experiment 1.5.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for src.core.experiment</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Experiment data and execution manager.</span>

<span class="sd">An `Experiment` is an object which keeps tracks of all the parts which compose</span>
<span class="sd">an actual measurement, including instruments, the actions performed on them, the</span>
<span class="sd">data returned by them, and real-time graphs of the data.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">cPickle</span> <span class="kn">as</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">src.core</span> <span class="kn">import</span> <span class="n">instrument</span> <span class="k">as</span> <span class="n">instmod</span>
<span class="kn">from</span> <span class="nn">src.core.action</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ActionContainer</span><span class="p">,</span> <span class="n">ActionThread</span><span class="p">,</span>
                             <span class="n">ActionLoopUntilInterrupt</span><span class="p">,</span> <span class="n">PARAM_ID</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">src.core.errors</span> <span class="kn">import</span> <span class="p">(</span><span class="n">InstrumentInUseError</span><span class="p">,</span> <span class="n">GeneralExperimentError</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">src.core.graph</span> <span class="kn">import</span> <span class="n">AbstractGraphManager</span>
<span class="kn">from</span> <span class="nn">src.tools.general</span> <span class="kn">import</span> <span class="n">formatReSTHeading</span>
<span class="kn">import</span> <span class="nn">src.tools.parsing</span> <span class="kn">as</span> <span class="nn">parsing</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;transport&#39;</span><span class="p">)</span>

<span class="n">MARK_CONSTANT</span> <span class="o">=</span> <span class="s">&#39;@&#39;</span>
<span class="n">MARK_PARAMETER</span> <span class="o">=</span> <span class="s">&#39;$&#39;</span>
<span class="n">MARK_COLUMN</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span>
<span class="n">SUB_CONSTANT</span> <span class="o">=</span> <span class="s">&#39;@(</span><span class="si">%s</span><span class="s">)&#39;</span>
<span class="n">SUB_PARAMETER</span> <span class="o">=</span> <span class="s">&#39;$(</span><span class="si">%s</span><span class="s">)&#39;</span>
<span class="n">SUB_COLUMN</span> <span class="o">=</span> <span class="s">&#39;#(</span><span class="si">%s</span><span class="s">)&#39;</span>

<span class="n">_SUPPORTED_FUNCTIONS</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;abs&#39;</span><span class="p">:</span> <span class="s">&#39;abs&#39;</span><span class="p">,</span>
                        <span class="s">&#39;sin&#39;</span><span class="p">:</span> <span class="s">&#39;math.sin&#39;</span><span class="p">,</span>
                        <span class="s">&#39;cos&#39;</span><span class="p">:</span> <span class="s">&#39;math.cos&#39;</span><span class="p">,</span>
                        <span class="s">&#39;tan&#39;</span><span class="p">:</span> <span class="s">&#39;math.tan&#39;</span><span class="p">,</span>
                        <span class="s">&#39;arcsin&#39;</span><span class="p">:</span> <span class="s">&#39;math.asin&#39;</span><span class="p">,</span>
                        <span class="s">&#39;arccos&#39;</span><span class="p">:</span> <span class="s">&#39;math.acos&#39;</span><span class="p">,</span>
                        <span class="s">&#39;arctan&#39;</span><span class="p">:</span> <span class="s">&#39;math.atan&#39;</span><span class="p">,</span>
                        <span class="s">&#39;arctan2&#39;</span><span class="p">:</span> <span class="s">&#39;math.atan2&#39;</span><span class="p">,</span>
                        <span class="s">&#39;deg2rad&#39;</span><span class="p">:</span> <span class="s">&#39;math.radians&#39;</span><span class="p">,</span>
                        <span class="s">&#39;rad2deg&#39;</span><span class="p">:</span> <span class="s">&#39;math.degrees&#39;</span><span class="p">,</span>
                        <span class="s">&#39;sinh&#39;</span><span class="p">:</span> <span class="s">&#39;math.sinh&#39;</span><span class="p">,</span>
                        <span class="s">&#39;cosh&#39;</span><span class="p">:</span> <span class="s">&#39;math.cosh&#39;</span><span class="p">,</span>
                        <span class="s">&#39;tanh&#39;</span><span class="p">:</span> <span class="s">&#39;math.tanh&#39;</span><span class="p">,</span>
                        <span class="s">&#39;arcsinh&#39;</span><span class="p">:</span> <span class="s">&#39;math.asinh&#39;</span><span class="p">,</span>
                        <span class="s">&#39;arccosh&#39;</span><span class="p">:</span> <span class="s">&#39;math.acosh&#39;</span><span class="p">,</span>
                        <span class="s">&#39;arctanh&#39;</span><span class="p">:</span> <span class="s">&#39;math.atanh&#39;</span><span class="p">,</span>
                        <span class="s">&#39;pow&#39;</span><span class="p">:</span> <span class="s">&#39;math.pow&#39;</span><span class="p">,</span>
                        <span class="s">&#39;sqrt&#39;</span><span class="p">:</span> <span class="s">&#39;math.sqrt&#39;</span><span class="p">,</span>
                        <span class="s">&#39;exp&#39;</span><span class="p">:</span> <span class="s">&#39;math.exp&#39;</span><span class="p">,</span>
                        <span class="s">&#39;log&#39;</span><span class="p">:</span> <span class="s">&#39;math.log&#39;</span><span class="p">,</span>
                        <span class="s">&#39;log10&#39;</span><span class="p">:</span> <span class="s">&#39;math.log10&#39;</span><span class="p">,</span>
                        <span class="s">&#39;ceil&#39;</span><span class="p">:</span> <span class="s">&#39;math.ceil&#39;</span><span class="p">,</span>
                        <span class="s">&#39;floor&#39;</span><span class="p">:</span> <span class="s">&#39;math.floor&#39;</span><span class="p">}</span>

<span class="n">_EXTS_DATA</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">EXTS_DATA</span>
<span class="n">_EXTS_PARAMETERS</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">EXTS_PARAMETERS</span>
<span class="n">_EXTS_IMAGE</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">EXTS_IMAGE</span>

<div class="viewcode-block" id="Experiment"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment">[docs]</a><span class="k">class</span> <span class="nc">Experiment</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The main driver class of an experiment.</span>

<span class="sd">    The `Experiment` class is responsible for managing instruments; the actions</span>
<span class="sd">    those instruments should perform; and the collection, storage, saving, and</span>
<span class="sd">    graphing of data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Creating an experiment...&#39;</span><span class="p">)</span>

        <span class="c"># The database of constants defined before the experiment is run. All</span>
        <span class="c"># values will be coerced to floats.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constants</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># The list of instruments in the experiment, initialized to contain</span>
        <span class="c"># the two built-in instruments.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instruments</span> <span class="o">=</span> <span class="p">[</span><span class="n">instmod</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">instmod</span><span class="o">.</span><span class="n">Postprocessor</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>

        <span class="c"># A tree structure for containing the experiment&#39;s action sequence.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span> <span class="o">=</span> <span class="n">ActionContainer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;root&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c"># A dictionary of parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c"># A list for storing parameter data before the file has been opened.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># A dictionary for column data. They keys are the names of the columns,</span>
        <span class="c"># and the values are sub-dictionaries with the following keys:</span>
        <span class="c"># curr : str</span>
        <span class="c">#     The most recently acquired value, already formatted.</span>
        <span class="c"># colindex : int</span>
        <span class="c">#     The position in the **ordered** array where the data from this</span>
        <span class="c">#     column should go.</span>
        <span class="c"># graphx : list of `Graph`</span>
        <span class="c">#     The list of graphs which should receive x-values whenever this</span>
        <span class="c">#     column is updated.</span>
        <span class="c"># graphy : list of `Graph`</span>
        <span class="c">#     The list of graphs which should receive y-values whenever this</span>
        <span class="c">#     column is updated.</span>
        <span class="c"># graphadd : list of `Graph`</span>
        <span class="c">#     The list of graphs which should produce next plots whenever</span>
        <span class="c">#     this column is updated.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c"># An array containing column names in the order in which they should be</span>
        <span class="c"># written to the file.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_columnArray</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastColumnIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c"># The experiment&#39;s list of `Graph` objects.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># A buffer for holding data while a simultaneous block is running.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempBuffer</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># The basic file name, without an extension, for forming the filenames</span>
        <span class="c"># for the actual filenames, and the extension to be used for the data</span>
        <span class="c"># files.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filenameBase</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extension</span> <span class="o">=</span> <span class="s">&#39;.xdat&#39;</span>
        <span class="c"># Files to which data will be written.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataFile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameterFile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graphFile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># List of tuples containing the paths of all files which have been</span>
        <span class="c"># opened during the experiment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allFiles</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Flags describing the status of the experiment. In order, they are</span>
        <span class="c"># [running, paused, interrupted]. The third is for stopping the</span>
        <span class="c"># indefinite-loop type actions.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">]</span>

        <span class="c"># A StatusMonitor for displaying experiment history to the user.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statusMonitor</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Lists of commands to execute before and after the experiment. They</span>
        <span class="c"># are set by whatever creates the experiment, and their primary purpose</span>
        <span class="c"># is to update indicators in a GUI.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preSequenceActions</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_postSequenceActions</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Lists of commands to execute before and after an interruptable loop.</span>
        <span class="c"># They are set by whatever creates the experiment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loopEnterCommands</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loopExitCommands</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="c"># A list of ActionPostprocessor objects which will be executed at the</span>
        <span class="c"># end of the experiment (during the post-sequence).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_postprocessorActions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># A subclass of `AbstractGraphManager` for managing the threads for</span>
        <span class="c"># the graphs, an instance of that class, and the frame which should</span>
        <span class="c"># be the parent for the graphing frames.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graphManagerClass</span> <span class="o">=</span> <span class="n">AbstractGraphManager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graphManager</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parentFrame</span> <span class="o">=</span> <span class="bp">None</span>


    <span class="c">#-------------------------------------------------------- Instrument control</span>

<div class="viewcode-block" id="Experiment.getInstrumentStrings"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getInstrumentStrings">[docs]</a>    <span class="k">def</span> <span class="nf">getInstrumentStrings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the names of the instruments in this experiment.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            A list of strings representing the names of the `Instrument` objects</span>
<span class="sd">            which used in this experiment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">instrument</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instruments</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Experiment.addInstrument"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.addInstrument">[docs]</a>    <span class="k">def</span> <span class="nf">addInstrument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add an instrument to this experiment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        instrument : Instrument</span>
<span class="sd">            The `Instrument` object which should be added to the experiment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instruments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instrument</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Experiment.removeInstrument"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.removeInstrument">[docs]</a>    <span class="k">def</span> <span class="nf">removeInstrument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove an instrument from this experiment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        instrument : Instrument</span>
<span class="sd">            The instrument which should be removed from the experiment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">uses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkForInstrumentUsage</span><span class="p">(</span><span class="n">instrument</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uses</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instruments</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">instrument</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InstrumentInUseError</span><span class="p">(</span><span class="n">uses</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Experiment.getInstrument"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getInstrument">[docs]</a>    <span class="k">def</span> <span class="nf">getInstrument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the instrument at the specified index.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            The index of the `Instrument` which should be returned.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Instrument</span>
<span class="sd">            The instrument located at the specified position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instruments</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Experiment.getEqualEnoughInstruments"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getEqualEnoughInstruments">[docs]</a>    <span class="k">def</span> <span class="nf">getEqualEnoughInstruments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of instruments which implement the given action.</span>

<span class="sd">        Sometimes, the user may want to change the instrument which carries out</span>
<span class="sd">        a particular action. However, in order to change the instrument, it is</span>
<span class="sd">        necessary that the new instrument should have the *ability* to carry out</span>
<span class="sd">        the action.</span>

<span class="sd">        This method returns a list of dictionaries with information about the</span>
<span class="sd">        instruments (and their respective actions) which could potentially be</span>
<span class="sd">        used as a replacement for the instrument associated with the specified</span>
<span class="sd">        action.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        action : Action</span>
<span class="sd">            The `Action` instance whose `Instrument` the user wants to replace.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of dict</span>
<span class="sd">            A list of dictionaries. Each dictionary represents information about</span>
<span class="sd">            one `Action` which could replace `action`. The elements of the</span>
<span class="sd">            dictionary are the following:</span>
<span class="sd">                instrument_index</span>
<span class="sd">                    The index of the instrument in the experiment&#39;s list.</span>
<span class="sd">                instrument</span>
<span class="sd">                    The actual `Instrument` object.</span>
<span class="sd">                instrument_name</span>
<span class="sd">                    The name of the instrument.</span>
<span class="sd">                action_index</span>
<span class="sd">                    The index of the `Action` object which can replace `action`.</span>
<span class="sd">                    The index corresponds to the location in the list of</span>
<span class="sd">                    actions returned by the instrument&#39;s `getActions` method. </span>
<span class="sd">                action</span>
<span class="sd">                    An `ActionSpec` representing the `Action` which can replace</span>
<span class="sd">                    the specified `action`.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Two `Action` objects are said to be &quot;equal enough&quot; if they have the same</span>
<span class="sd">        description and the same parameters. Two `Parameter` objects are said</span>
<span class="sd">        to be the same if they are identical in all *immutable* aspects (that</span>
<span class="sd">        is, they have the same name, the same description, and the same format</span>
<span class="sd">        string).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">inst</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_instruments</span><span class="p">):</span>
            <span class="n">equalEnough</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">getEqualEnoughAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">equalEnough</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;instrument_index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
                               <span class="s">&#39;instrument&#39;</span><span class="p">:</span> <span class="n">inst</span><span class="p">,</span>
                               <span class="s">&#39;instrument_name&#39;</span><span class="p">:</span> <span class="n">inst</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span>
                               <span class="s">&#39;action_index&#39;</span><span class="p">:</span> <span class="n">equalEnough</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="s">&#39;action&#39;</span><span class="p">:</span> <span class="n">equalEnough</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
        <span class="k">return</span> <span class="n">result</span>


    <span class="c">#------------------------------------------------------ Constants management</span>
</div>
<div class="viewcode-block" id="Experiment.setConstant"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.setConstant">[docs]</a>    <span class="k">def</span> <span class="nf">setConstant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the value of a constant, creating it if necessary.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the constant whose value should be set.</span>
<span class="sd">        value : float</span>
<span class="sd">            The new value for the constant.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="Experiment.removeConstant"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.removeConstant">[docs]</a>    <span class="k">def</span> <span class="nf">removeConstant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete a defined constant.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the constant which should be deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Experiment.getConstant"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getConstant">[docs]</a>    <span class="k">def</span> <span class="nf">getConstant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value of the named constant.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the constant whose value is desired.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The value of the requested constant, or `None` if the constant</span>
<span class="sd">            does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Experiment.getAllConstants"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getAllConstants">[docs]</a>    <span class="k">def</span> <span class="nf">getAllConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of the constants dictionary.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            A dictionary of constants in which the keys (str) are the names</span>
<span class="sd">            of the constants, and the values (float) are the values associated </span>
<span class="sd">            with the relevant constant.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Experiment.renameConstant"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.renameConstant">[docs]</a>    <span class="k">def</span> <span class="nf">renameConstant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldName</span><span class="p">,</span> <span class="n">newName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rename the specified constant.</span>
<span class="sd">        </span>
<span class="sd">        Rename a constant and update all expressions in conditional loops</span>
<span class="sd">        and calculations to reflect the name change.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        oldName : str</span>
<span class="sd">            The name of the constant to whose name should be changed.</span>
<span class="sd">        newName : str</span>
<span class="sd">            The new name of the constant.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="p">[</span><span class="n">newName</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">oldName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateEvaluations</span><span class="p">(</span><span class="n">oldName</span><span class="p">,</span> <span class="s">&#39;constant&#39;</span><span class="p">,</span> <span class="n">newName</span><span class="p">,</span> <span class="s">&#39;constant&#39;</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Experiment.addDefaultConstants"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.addDefaultConstants">[docs]</a>    <span class="k">def</span> <span class="nf">addDefaultConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add pi and the natural logarithm base to the constant dictionary.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="p">[</span><span class="s">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="p">[</span><span class="s">&#39;e&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">e</span>


    <span class="c">#-------------------------------------------------------- Data storage setup</span>
</div>
<div class="viewcode-block" id="Experiment.handleStorageBins"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.handleStorageBins">[docs]</a>    <span class="k">def</span> <span class="nf">handleStorageBins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldName</span><span class="p">,</span> <span class="n">oldType</span><span class="p">,</span> <span class="n">newName</span><span class="p">,</span> <span class="n">newType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Automatically handle the addition, removal, or renaming of a bin.</span>

<span class="sd">        If the new name is `None` or &#39;&#39;, delete the old bin. If the old name is</span>
<span class="sd">        `None` or &#39;&#39;, create the new bin. If the old name and the new name are</span>
<span class="sd">        are both non-trivial, the old name is changed to the new name, and the</span>
<span class="sd">        types are switched if necessary.</span>
<span class="sd">                </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        oldName : str</span>
<span class="sd">            The name of the column or parameter to be removed. If none is to be</span>
<span class="sd">            removed, this should be either `None` or an empty string.</span>
<span class="sd">        oldType : str</span>
<span class="sd">            The type (&quot;column&quot; or &quot;parameter&quot;) of the bin to be removed. If a</span>
<span class="sd">            bin is to be created and none removed, this value is ignored.</span>
<span class="sd">        newName : str</span>
<span class="sd">            The name of the column or parameter to be created. If none is to be</span>
<span class="sd">            created, this should be either `None` or an empty string.</span>
<span class="sd">        newType : str</span>
<span class="sd">            The type (&quot;column&quot; or &quot;parameter&quot;) of the bin to be created. If</span>
<span class="sd">            none is to be created, this value is ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">oldName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">oldName</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">newName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">newName</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">oldName</span> <span class="o">=</span> <span class="n">oldName</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">newName</span> <span class="o">=</span> <span class="n">newName</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">oldName</span> <span class="o">==</span> <span class="n">newName</span> <span class="ow">and</span> <span class="n">oldType</span> <span class="o">==</span> <span class="n">newType</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">oldName</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addStorageBin</span><span class="p">(</span><span class="n">newName</span><span class="p">,</span> <span class="n">newType</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Adding </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">newType</span><span class="p">,</span> <span class="n">newName</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">newName</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deleteStorageBin</span><span class="p">(</span><span class="n">oldName</span><span class="p">,</span> <span class="n">oldType</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Removing </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">oldType</span><span class="p">,</span> <span class="n">oldName</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_renameStorageBin</span><span class="p">(</span><span class="n">oldName</span><span class="p">,</span> <span class="n">oldType</span><span class="p">,</span> <span class="n">newName</span><span class="p">,</span> <span class="n">newType</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Replacing </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> with </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
                  <span class="n">oldType</span><span class="p">,</span> <span class="n">oldName</span><span class="p">,</span> <span class="n">newType</span><span class="p">,</span> <span class="n">newName</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;New columns are: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</div>
    <span class="k">def</span> <span class="nf">_addStorageBin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">binType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a column or parameter.</span>
<span class="sd">        </span>
<span class="sd">        If the bin to create is a column, and a missing column of the same</span>
<span class="sd">        name is the reason a graph is disabled, bind the new column to the</span>
<span class="sd">        graph and reenable it.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the bin to create.</span>
<span class="sd">        binType : str</span>
<span class="sd">            The type of the bin to create. It may be either &#39;parameter&#39; or</span>
<span class="sd">            &#39;column&#39;. If `binType` is not recognized, it defaults to &#39;column&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">binType</span> <span class="o">==</span> <span class="s">&#39;parameter&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;curr&#39;</span>     <span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                                       <span class="s">&#39;colindex&#39;</span> <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                                       <span class="s">&#39;graphx&#39;</span>   <span class="p">:</span> <span class="p">[],</span>
                                       <span class="s">&#39;graphy&#39;</span>   <span class="p">:</span> <span class="p">[],</span>
                                       <span class="s">&#39;graphadd&#39;</span> <span class="p">:</span> <span class="p">[]}</span>
                <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">graph</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                        <span class="n">reenable</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="n">graphColumns</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">getColumns</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">graphColumn</span> <span class="ow">in</span> <span class="n">graphColumns</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">graphColumn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="ow">and</span>
                                <span class="n">graphColumn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                                <span class="n">reenable</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">if</span> <span class="n">reenable</span><span class="p">:</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">graphColumns</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;graphx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">graphColumns</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;graphy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">graphColumns</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;graphadd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Reenabling graph </span><span class="si">%s</span><span class="s">.&#39;</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">getTitle</span><span class="p">())</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_renameStorageBin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldName</span><span class="p">,</span> <span class="n">oldType</span><span class="p">,</span> <span class="n">newName</span><span class="p">,</span> <span class="n">newType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rename a storage bin.</span>
<span class="sd">         </span>
<span class="sd">        Rename a storage bin, and then update all calculations, conditional</span>
<span class="sd">        expressions, and graphs to reflect the change in name. If after </span>
<span class="sd">        renaming one instance of `oldName` there are no `Action` instances </span>
<span class="sd">        referring to `oldName`, then delete all data bins associated with </span>
<span class="sd">        `oldName`.</span>
<span class="sd">        </span>
<span class="sd">        If an attempt is made to change a column to a parameter and if that</span>
<span class="sd">        column is bound to a graph, disable the graph.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        oldName : str</span>
<span class="sd">            The name of the bin to rename.</span>
<span class="sd">        oldType : str</span>
<span class="sd">            The type of the bin to rename, which may be either &#39;parameter&#39; or</span>
<span class="sd">            &#39;column&#39;.</span>
<span class="sd">        newName : str</span>
<span class="sd">            The new name for the bin.</span>
<span class="sd">        newType : str</span>
<span class="sd">            The new type for the bin, which may be either &#39;parameter&#39; or</span>
<span class="sd">            &#39;column&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">oldType</span> <span class="o">==</span> <span class="s">&#39;column&#39;</span><span class="p">:</span>
            <span class="n">graphs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">oldName</span><span class="p">][</span><span class="s">&#39;graphx&#39;</span><span class="p">],</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">oldName</span><span class="p">][</span><span class="s">&#39;graphy&#39;</span><span class="p">],</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">oldName</span><span class="p">][</span><span class="s">&#39;graphadd&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_addStorageBin</span><span class="p">(</span><span class="n">newName</span><span class="p">,</span> <span class="n">newType</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleteStorageBin</span><span class="p">(</span><span class="n">oldName</span><span class="p">,</span> <span class="n">oldType</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateEvaluations</span><span class="p">(</span><span class="n">oldName</span><span class="p">,</span> <span class="n">oldType</span><span class="p">,</span> <span class="n">newName</span><span class="p">,</span> <span class="n">newType</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">oldType</span> <span class="o">==</span> <span class="s">&#39;column&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">newType</span> <span class="o">==</span> <span class="s">&#39;column&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">updateColumnsIfNecessary</span><span class="p">(</span><span class="n">oldName</span><span class="p">,</span> <span class="n">newName</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">updateColumnsIfNecessary</span><span class="p">(</span><span class="n">oldName</span><span class="p">,</span> <span class="n">newName</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">updateColumnsIfNecessary</span><span class="p">(</span><span class="n">oldName</span><span class="p">,</span> <span class="n">newName</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">newName</span><span class="p">][</span><span class="s">&#39;graphx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graphs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">newName</span><span class="p">][</span><span class="s">&#39;graphy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graphs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">newName</span><span class="p">][</span><span class="s">&#39;graphadd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graphs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">newType</span> <span class="o">==</span> <span class="s">&#39;parameter&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">graphs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">graphs</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">((</span><span class="s">&#39;Graph </span><span class="si">%s</span><span class="s"> is being disabled because &#39;</span>
                                  <span class="s">&#39;it requires data from the column </span><span class="si">%s</span><span class="s">, &#39;</span>
                                  <span class="s">&#39;which is being changed to a parameter.&#39;</span><span class="p">),</span>
                                 <span class="n">graph</span><span class="o">.</span><span class="n">getTitle</span><span class="p">(),</span> <span class="n">oldName</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deleteStorageBin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">binType</span><span class="p">,</span> <span class="n">checkGraphs</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete the specified storage bin.</span>
<span class="sd">        </span>
<span class="sd">        Delete the specified storage bin if and only if only one action in the</span>
<span class="sd">        sequence refers to the bin at the time the command is issued.</span>
<span class="sd">        </span>
<span class="sd">        If a column bound to a graph is deleted, then disable the bound</span>
<span class="sd">        graph, unless this behavior is overridden by setting `checkGraphs` to</span>
<span class="sd">        `False`.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the storage bin to remove.</span>
<span class="sd">        binType : str</span>
<span class="sd">            The type of the storage bin to remove. Allowed values are &quot;column&quot;</span>
<span class="sd">            and &quot;parameter&quot;.</span>
<span class="sd">        checkGraphs : bool</span>
<span class="sd">            Whether to check the graph list to see whether any of the graphs</span>
<span class="sd">            require the column which is about to be deleted. If this flag is</span>
<span class="sd">            set to `True` and a graph does require the column, that graph</span>
<span class="sd">            will be disabled.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            Whether the bin was actually deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graphs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">checkGraphs</span><span class="p">:</span>
            <span class="n">graphs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;graphx&#39;</span><span class="p">]</span> <span class="o">+</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;graphy&#39;</span><span class="p">]</span> <span class="o">+</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;graphadd&#39;</span><span class="p">])</span>

        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scanSequenceForStorageName</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">binType</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">binType</span> <span class="o">==</span> <span class="s">&#39;parameter&#39;</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">binType</span> <span class="o">==</span> <span class="s">&#39;column&#39;</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">:</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">((</span><span class="s">&#39;Graph </span><span class="si">%s</span><span class="s"> is being disabled because it &#39;</span>
                              <span class="s">&#39;receives data from column </span><span class="si">%s</span><span class="s">, which &#39;</span>
                              <span class="s">&#39;is being deleted.&#39;</span><span class="p">),</span> <span class="n">graph</span><span class="o">.</span><span class="n">getTitle</span><span class="p">(),</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_prepareColumns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Order the columns.</span>
<span class="sd">        </span>
<span class="sd">        Automatically scan through the list of actions to put the columns into</span>
<span class="sd">        the appropriate order, so that the order in the data file reflects the</span>
<span class="sd">        order in which the actions are executed. After this is run, each element</span>
<span class="sd">        in the column dictionary should contain an index which points to a</span>
<span class="sd">        position in the column array. The column array is filled in with the</span>
<span class="sd">        names of the columns in the order in which they will be written to the</span>
<span class="sd">        data file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">numberColumns</span><span class="p">(</span><span class="n">act</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Number the columns used by the specified action.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">act</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">getInputColumns</span><span class="p">()</span> <span class="o">+</span> <span class="n">act</span><span class="o">.</span><span class="n">getOutputColumns</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columnArray</span> <span class="ow">and</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s">&#39;colindex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_columnArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Numbering column </span><span class="si">%s</span><span class="s"> to </span><span class="si">%d</span><span class="s">.&#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_traverse</span><span class="p">(</span><span class="n">numberColumns</span><span class="p">)</span>

<div class="viewcode-block" id="Experiment.getStorageBinNames"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getStorageBinNames">[docs]</a>    <span class="k">def</span> <span class="nf">getStorageBinNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the names of all data storage bins.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            A list of the names of all constants in the experiment.</span>
<span class="sd">        list of str</span>
<span class="sd">            A list of the names of all columns in the experiment.</span>
<span class="sd">        list of str</span>
<span class="sd">            A list of the names of all parameters in the experiment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</div>
<div class="viewcode-block" id="Experiment.getStorageBinNamesString"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getStorageBinNamesString">[docs]</a>    <span class="k">def</span> <span class="nf">getStorageBinNamesString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a formatted string representing the storage bin names.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A three-line string, where the first line is a list of constants,</span>
<span class="sd">            the second is a list of columns, and the third is a list of</span>
<span class="sd">            parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&#39;constants: </span><span class="si">%s</span><span class="se">\n</span><span class="s">columns: </span><span class="si">%s</span><span class="se">\n</span><span class="s">parameters: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getStorageBinNames</span><span class="p">())</span>
    </div>
<div class="viewcode-block" id="Experiment.getColumnDetails"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getColumnDetails">[docs]</a>    <span class="k">def</span> <span class="nf">getColumnDetails</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a formatted string containing a list of column details.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A string containing details about the current status of each data</span>
<span class="sd">            column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allElements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Column </span><span class="si">%s</span><span class="s"> ----------------&#39;</span> <span class="o">%</span> <span class="n">column</span><span class="p">,</span>
                        <span class="s">&#39;Current:   </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;curr&#39;</span><span class="p">],</span>
                        <span class="s">&#39;Index:     </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;colindex&#39;</span><span class="p">],</span>
                        <span class="s">&#39;Graph X:   </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> 
                        <span class="p">[</span><span class="s">&#39;[&#39;</span> <span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">getTitle</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;]&#39;</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;graphx&#39;</span><span class="p">]],</span>
                        <span class="s">&#39;Graph Y:   </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> 
                        <span class="p">[</span><span class="s">&#39;[&#39;</span> <span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">getTitle</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;]&#39;</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;graphy&#39;</span><span class="p">]],</span>
                        <span class="s">&#39;Graph Add: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> 
                        <span class="p">[</span><span class="s">&#39;[&#39;</span> <span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">getTitle</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;]&#39;</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;graphadd&#39;</span><span class="p">]]]</span>
            <span class="n">allElements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">allElements</span><span class="p">)</span>
            

    <span class="c">#------------------------------------------------------- Actual data storage</span>
</div>
<div class="viewcode-block" id="Experiment.activateTemporaryBuffer"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.activateTemporaryBuffer">[docs]</a>    <span class="k">def</span> <span class="nf">activateTemporaryBuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a temporary buffer for simultaneous blocks.</span>
<span class="sd">        </span>
<span class="sd">        Create a temporary buffer, with the same keys as the main column</span>
<span class="sd">        dictionary, for storing data while running a simultaneous block. </span>
<span class="sd">        This alleviates the danger of getting goofy garbage in the data file </span>
<span class="sd">        due to, e.g., race conditions. The principal problem this averts is</span>
<span class="sd">        writing data to the file prematurely, which would happen if the actions</span>
<span class="sd">        return in the wrong order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempBuffer</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tempBuffer</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="Experiment.deactivateTemporaryBuffer"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.deactivateTemporaryBuffer">[docs]</a>    <span class="k">def</span> <span class="nf">deactivateTemporaryBuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the data from the temporary buffer, then destroy the buffer.</span>
<span class="sd">        </span>
<span class="sd">        Take the data stored in the temporary buffer while running the </span>
<span class="sd">        simultaneous block. If the same amount of data has been added for each</span>
<span class="sd">        column, add them to the appropriate column bins. Otherwise, save them</span>
<span class="sd">        as a separate file in the same folder as the data. Then destroy the </span>
<span class="sd">        temporary buffer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tempBuffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempBuffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempBuffer</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">sameSize</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">toKeep</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">tempBuffer</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">columnLength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">columnLength</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">toKeep</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">column</span>
                <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;colindex&#39;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">length</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">length</span> <span class="o">=</span> <span class="n">columnLength</span>
                <span class="k">elif</span> <span class="n">length</span> <span class="o">!=</span> <span class="n">columnLength</span><span class="p">:</span>
                    <span class="n">sameSize</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">sameSize</span><span class="p">:</span>
            <span class="n">sortedColumns</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">colname</span><span class="p">:</span> <span class="n">colname</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">sortedColumns</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">tempBuffer</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">saveData</span><span class="p">(</span><span class="s">&#39;column&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Unable to merge simultaneous block columns. &#39;</span>
                      <span class="s">&#39;The data is being saved to a separate file for you &#39;</span>
                      <span class="s">&#39;to sort out.&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filenameBase</span> <span class="o">+</span> <span class="s">&#39;_simblock.txt&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">simFile</span><span class="p">:</span>
                <span class="n">simFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;-------------&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">toKeep</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">simFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">simFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">column</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Experiment.saveData"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.saveData">[docs]</a>    <span class="k">def</span> <span class="nf">saveData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binType</span><span class="p">,</span> <span class="n">binName</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add data returned from actions to the appropriate dictionary.</span>
<span class="sd">        </span>
<span class="sd">        Take the input from the execute commands bound to an `Action` object</span>
<span class="sd">        and add it to the data column dictionary, the parameter dictionary, or </span>
<span class="sd">        the temporary buffer as appropriate.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        binType : str</span>
<span class="sd">            Where the data should go (either &quot;parameter&quot; or &quot;column&quot;).</span>
<span class="sd">        binName : str</span>
<span class="sd">            The name of the column or parameter.</span>
<span class="sd">        value : str</span>
<span class="sd">            The **formatted** value to be saved to the bin specified by the</span>
<span class="sd">            above parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">binType</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">binType</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="n">binName</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">binType</span> <span class="o">==</span> <span class="s">&#39;parameter&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">[</span><span class="n">binName</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parameterFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">binName</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">((</span><span class="s">&#39;Cannot write </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">. Perhaps the parameter file &#39;</span> <span class="o">+</span>
                          <span class="s">&#39;is not open.&#39;</span><span class="p">),</span> <span class="n">binName</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">binName</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempBuffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tempBuffer</span><span class="p">[</span><span class="n">binName</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>
            <span class="n">columnIndex</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="n">binName</span><span class="p">][</span><span class="s">&#39;colindex&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">columnIndex</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastColumnIndex</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dataFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cols</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s">&#39;curr&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span>
                                                <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columnArray</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lastColumnIndex</span> <span class="o">=</span> <span class="n">columnIndex</span>
            <span class="n">currcol</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="n">binName</span><span class="p">]</span>
            <span class="n">currcol</span><span class="p">[</span><span class="s">&#39;curr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">currcol</span><span class="p">[</span><span class="s">&#39;graphx&#39;</span><span class="p">]:</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">addX</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">currcol</span><span class="p">[</span><span class="s">&#39;graphy&#39;</span><span class="p">]:</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">addY</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">currcol</span><span class="p">[</span><span class="s">&#39;graphadd&#39;</span><span class="p">]:</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">flagNewPlot</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Experiment.checkExpression"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.checkExpression">[docs]</a>    <span class="k">def</span> <span class="nf">checkExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check the syntactic validity of the supplied expression.</span>
<span class="sd">        </span>
<span class="sd">        Substitute numeric values for columns, constants, and parameters</span>
<span class="sd">        and attempt to evaluate the given expression to determine whether the</span>
<span class="sd">        syntax of the expression is correct.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expr : str</span>
<span class="sd">            The expression to evaluate in string form.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            `True` if the expression&#39;s syntax is valid, or `False` otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">SUB_CONSTANT</span> <span class="o">%</span> <span class="n">name</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">SUB_COLUMN</span> <span class="o">%</span> <span class="n">name</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()))</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">SUB_PARAMETER</span> <span class="o">%</span> <span class="n">name</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()))</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_SUPPORTED_FUNCTIONS</span><span class="p">:</span>
                <span class="n">newName</span> <span class="o">=</span> <span class="n">_SUPPORTED_FUNCTIONS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="n">newName</span> <span class="o">+</span> <span class="s">&#39;(&#39;</span><span class="p">)</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; (&#39;</span><span class="p">,</span> <span class="n">newName</span> <span class="o">+</span> <span class="s">&#39;(&#39;</span><span class="p">)</span>
            <span class="nb">float</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Experiment.evaluateExpression"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.evaluateExpression">[docs]</a>    <span class="k">def</span> <span class="nf">evaluateExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">conditional</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate a given expression.</span>
<span class="sd">        </span>
<span class="sd">        Substitute all defined constants and the most recent values of all </span>
<span class="sd">        columns and parameters into `expr`, evaluate it, and return the</span>
<span class="sd">        outcome.</span>

<span class="sd">        This is mainly used by the `Calculate` action from the `System` class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expr : str</span>
<span class="sd">            A string giving the expression which should be evaluated.</span>
<span class="sd">        conditional : bool</span>
<span class="sd">            Whether the expression should evaluate to a boolean (`True` or</span>
<span class="sd">            `False`). The default is `False`, meaning that the expression should</span>
<span class="sd">            evaluate to a number.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float or bool</span>
<span class="sd">            If `conditional` is `True`, the boolean to which the supplied</span>
<span class="sd">            expression evaluates when known data have been substituted.</span>
<span class="sd">            Otherwise, the **number** to which the supplied expression </span>
<span class="sd">            evaluates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">SUB_CONSTANT</span> <span class="o">%</span> <span class="n">name</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempBuffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempBuffer</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tempBuffer</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">SUB_COLUMN</span> <span class="o">%</span> <span class="n">name</span>
                        <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempBuffer</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">SUB_COLUMN</span> <span class="o">%</span> <span class="n">name</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;curr&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">SUB_PARAMETER</span> <span class="o">%</span> <span class="n">name</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_SUPPORTED_FUNCTIONS</span><span class="p">:</span>
                <span class="n">newName</span> <span class="o">=</span> <span class="n">_SUPPORTED_FUNCTIONS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="n">newName</span> <span class="o">+</span> <span class="s">&#39;(&#39;</span><span class="p">)</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; (&#39;</span><span class="p">,</span> <span class="n">newName</span> <span class="o">+</span> <span class="s">&#39;(&#39;</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">conditional</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">ans</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">SyntaxError</span><span class="p">),</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">conditional</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Cannot evaluate conditional [</span><span class="si">%s</span><span class="s">]. &#39;</span>
                          <span class="s">&#39;Returning False.</span><span class="se">\n</span><span class="s">&gt;&gt;&gt;&gt;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Cannot evaluate expression [</span><span class="si">%s</span><span class="s">]. Returning NaN</span><span class="se">\n</span><span class="s">&gt;&gt;&gt;&gt;</span><span class="si">%s</span><span class="s">.&#39;</span><span class="p">,</span>
                      <span class="n">expr</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;nan&#39;</span><span class="p">)</span>
        

    <span class="c">#----------------------------------------------------------- Action sequence</span>
</div>
<div class="viewcode-block" id="Experiment.getActionRoot"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getActionRoot">[docs]</a>    <span class="k">def</span> <span class="nf">getActionRoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the root of the action tree.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ActionContainer</span>
<span class="sd">            The `ActionContainer` object which serves as the root of the</span>
<span class="sd">            sequence tree.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span>
            </div>
<div class="viewcode-block" id="Experiment.addPostprocessorAction"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.addPostprocessorAction">[docs]</a>    <span class="k">def</span> <span class="nf">addPostprocessorAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a Postprocessor action to be executed after the experiment.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        action : ActionPostprocessor</span>
<span class="sd">            An action to execute at the end of the experiment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_postprocessorActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_checkSequenceForErrors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check the sequence for problems.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of tuple of str</span>
<span class="sd">            A list of tuples, where each tuple contains two elements. The first</span>
<span class="sd">            is either &#39;warning&#39; or &#39;error&#39;, depending on the severity of the </span>
<span class="sd">            problem, and the second is a message giving more detail about the</span>
<span class="sd">            problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fileOpen</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">]</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">definedColumns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">definedParameters</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">checkAuxActions</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Check each action for problems.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
            <span class="n">inputProperties</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">getInputProperties</span><span class="p">()</span>
            <span class="n">outputProperties</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">getOutputProperties</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;set_file&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">inputProperties</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
                    <span class="n">answer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Folder &quot;</span><span class="si">%s</span><span class="s">&quot; does not exist.&#39;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">fileOpen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;calculate&#39;</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;loop_while&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;calculate&#39;</span><span class="p">:</span>
                    <span class="n">expression</span> <span class="o">=</span> <span class="n">inputProperties</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">expression</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">getExpression</span><span class="p">()</span>
                <span class="n">allData</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">definedData</span> <span class="o">=</span> <span class="p">(</span><span class="n">definedColumns</span><span class="p">,</span> <span class="n">definedParameters</span><span class="p">)</span>
                <span class="n">answer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_checkExpressionForErrors</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">allData</span><span class="p">,</span>
                                                        <span class="n">definedData</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkExpression</span><span class="p">(</span><span class="n">expression</span><span class="p">):</span>
                    <span class="n">answer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="s">&#39;Syntax error in expression [</span><span class="si">%s</span><span class="s">].&#39;</span>
                                   <span class="o">%</span> <span class="n">expression</span><span class="p">))</span>
            <span class="n">newBins</span> <span class="o">=</span> <span class="n">_getCreatedBins</span><span class="p">(</span><span class="n">inputProperties</span><span class="p">,</span> <span class="n">outputProperties</span><span class="p">)</span>
            <span class="n">definedColumns</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">newBins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">definedParameters</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">newBins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fileOpen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">definedColumns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">answer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="s">&#39;Writing to columns before &#39;</span> <span class="o">+</span>
                               <span class="s">&#39;a file is opened: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">definedColumns</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_traverse</span><span class="p">(</span><span class="n">checkAuxActions</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="p">:</span>
            <span class="n">toDisable</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">getColumns</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">definedColumns</span><span class="p">:</span>
                    <span class="n">toDisable</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">toDisable</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                <span class="n">answer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;warning&#39;</span><span class="p">,</span> <span class="s">&#39;Graph [</span><span class="si">%s</span><span class="s">] is disabled.&#39;</span> <span class="o">%</span>
                               <span class="n">item</span><span class="o">.</span><span class="n">getTitle</span><span class="p">()))</span>

        <span class="k">return</span> <span class="n">answer</span>

    <span class="k">def</span> <span class="nf">_checkForInstrumentUsage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of actions which use the specified instrument.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        instrument : Instrument</span>
<span class="sd">            The `Instrument` object whose usage is to be determined.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            A list of strings representing the actions which rely on</span>
<span class="sd">            `instrument`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">usageData</span> <span class="o">=</span> <span class="p">[</span><span class="n">instrument</span><span class="p">,</span> <span class="p">[]]</span>
        <span class="k">def</span> <span class="nf">checkAux</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Helper function to check a single instrument.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span> <span class="ow">is</span> <span class="n">usageData</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">usageData</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">action</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_traverse</span><span class="p">(</span><span class="n">checkAux</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">usageData</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_scanSequenceForStorageName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">binType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Count occurrences of the specified bin in the action sequence.</span>
<span class="sd">        </span>
<span class="sd">        Search through the action tree for references to the bin named `name` of</span>
<span class="sd">        type `binType`, and return the total number of matches.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the bin for which to search.</span>
<span class="sd">        binType : str</span>
<span class="sd">            The type of the bin named `name`. May be either &#39;column&#39; or</span>
<span class="sd">            &#39;parameter&#39;.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The number of times the bin of type `binType` and name `name`</span>
<span class="sd">            occurs in the action sequence tree.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">binType</span> <span class="o">==</span> <span class="s">&#39;parameter&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">PARAM_ID</span> <span class="o">+</span> <span class="n">name</span>
        <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">counter</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Helper function to count occurrences in each action.&quot;&quot;&quot;</span>
            <span class="n">colnames</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">getInputColumns</span><span class="p">()</span> <span class="o">+</span> <span class="n">action</span><span class="o">.</span><span class="n">getOutputColumns</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">colnames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">colname</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_traverse</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_updateEvaluations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldName</span><span class="p">,</span> <span class="n">oldType</span><span class="p">,</span> <span class="n">newName</span><span class="p">,</span> <span class="n">newType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change evaluations to reflect bin name changes.</span>
<span class="sd">         </span>
<span class="sd">        Run through the actions defined in the experiment. Update any </span>
<span class="sd">        calculation or conditional which refers to the bin `oldName` to refer </span>
<span class="sd">        to the bin `newName` instead.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        oldName : str</span>
<span class="sd">            The old name of the data bin.</span>
<span class="sd">        oldType : str</span>
<span class="sd">            The type of the old bin, which may be &#39;constant&#39;, &#39;column&#39;, or</span>
<span class="sd">            &#39;parameter&#39;.</span>
<span class="sd">        newName : str</span>
<span class="sd">            The type name of the data bin.</span>
<span class="sd">        newType : str</span>
<span class="sd">            The type of the new bin, which may be &#39;constant&#39;, &#39;column&#39;, or</span>
<span class="sd">            &#39;parameter&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">oldType</span> <span class="o">==</span> <span class="s">&#39;constant&#39;</span><span class="p">:</span>
            <span class="n">mOld</span> <span class="o">=</span> <span class="n">SUB_CONSTANT</span> <span class="o">%</span> <span class="n">oldName</span>
        <span class="k">elif</span> <span class="n">oldType</span> <span class="o">==</span> <span class="s">&#39;parameter&#39;</span><span class="p">:</span>
            <span class="n">mOld</span> <span class="o">=</span> <span class="n">SUB_PARAMETER</span> <span class="o">%</span> <span class="n">oldName</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mOld</span> <span class="o">=</span> <span class="n">SUB_COLUMN</span> <span class="o">%</span> <span class="n">oldName</span>

        <span class="k">if</span> <span class="n">newType</span> <span class="o">==</span> <span class="s">&#39;constant&#39;</span><span class="p">:</span>
            <span class="n">mNew</span> <span class="o">=</span> <span class="n">SUB_CONSTANT</span> <span class="o">%</span> <span class="n">newName</span>
        <span class="k">elif</span> <span class="n">newType</span> <span class="o">==</span> <span class="s">&#39;parameter&#39;</span><span class="p">:</span>
            <span class="n">mNew</span> <span class="o">=</span> <span class="n">SUB_PARAMETER</span> <span class="o">%</span> <span class="n">newName</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mNew</span> <span class="o">=</span> <span class="n">SUB_COLUMN</span> <span class="o">%</span> <span class="n">newName</span>

        <span class="n">columnData</span> <span class="o">=</span> <span class="p">[</span><span class="n">mOld</span><span class="p">,</span> <span class="n">mNew</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">updateName</span><span class="p">(</span><span class="n">act</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Helper to update the name in a single conditional.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">act</span><span class="o">.</span><span class="n">getDescription</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Calculate&#39;</span> <span class="ow">or</span>
                <span class="n">act</span><span class="o">.</span><span class="n">getDescription</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Conditional interrupt&#39;</span><span class="p">):</span>
                <span class="n">act</span><span class="o">.</span><span class="n">replaceStringInInput</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">columnData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">columnData</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_traverse</span><span class="p">(</span><span class="n">updateName</span><span class="p">)</span>


    <span class="c">#------------------------------------------------------------ Graphs control</span>

<div class="viewcode-block" id="Experiment.getGraphStrings"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getGraphStrings">[docs]</a>    <span class="k">def</span> <span class="nf">getGraphStrings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of the names of the experiment&#39;s graphs.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            A list of strings, where each string is the name of a graph in the</span>
<span class="sd">            experiment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">graph</span><span class="o">.</span><span class="n">getTitle</span><span class="p">()</span> <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Experiment.getGraphStringsAndStates"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getGraphStringsAndStates">[docs]</a>    <span class="k">def</span> <span class="nf">getGraphStringsAndStates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the names of graphs and whether each graph is enabled.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The title of the graph.</span>
<span class="sd">        bool</span>
<span class="sd">            Whether the graph is enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">graph</span><span class="o">.</span><span class="n">getTitle</span><span class="p">(),</span> <span class="n">graph</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">())</span> <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Experiment.getGraph"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getGraph">[docs]</a>    <span class="k">def</span> <span class="nf">getGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the graph at the specified index.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            The position of the desired graph in the experiment&#39;s list.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Graph</span>
<span class="sd">            The graph at the specified position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Experiment.addGraph"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.addGraph">[docs]</a>    <span class="k">def</span> <span class="nf">addGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a graph to the experiment.</span>
<span class="sd">        </span>
<span class="sd">        Store `graph` in the list, and bind it to the columns which will </span>
<span class="sd">        supply its data.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        graph : Graph</span>
<span class="sd">            A `Graph` object to add to the experiment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">getColumns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;graphx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s">&#39;graphy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cols</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="s">&#39;graphadd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Experiment.removeGraph"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.removeGraph">[docs]</a>    <span class="k">def</span> <span class="nf">removeGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a graph from the experiment</span>
<span class="sd">        </span>
<span class="sd">        First, remove `graph` from all columns which reference it. Then</span>
<span class="sd">        delete it from the list of graphs.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        graph : Graph</span>
<span class="sd">            The `Graph` object to remove from the list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">graph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s">&#39;graphx&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s">&#39;graphx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">graph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s">&#39;graphy&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s">&#39;graphy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">graph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s">&#39;graphadd&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s">&#39;graphadd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Experiment.updateGraphColumns"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.updateGraphColumns">[docs]</a>    <span class="k">def</span> <span class="nf">updateGraphColumns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fix the column dictionary so that the graph is in the right slots.</span>
<span class="sd">        </span>
<span class="sd">        Remove the graph from the list (which includes unbinding it from the</span>
<span class="sd">        old columns), and then add it back, automatically placing the graph in </span>
<span class="sd">        the slots for the newly-specified columns.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        graph : Graph</span>
<span class="sd">            The `Graph` object whose associated columns have changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_updateGraphLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldLabel</span><span class="p">,</span> <span class="n">newLabel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the axes&#39; labels to reflect column name changes.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        oldLabel : str</span>
<span class="sd">            The name of the column from which the graph previously received</span>
<span class="sd">            data.</span>
<span class="sd">        newLabel : str</span>
<span class="sd">            The name of the column from which the graph should now receive</span>
<span class="sd">            data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">updateColumnsIfNecessary</span><span class="p">(</span><span class="n">oldLabel</span><span class="p">,</span> <span class="n">newLabel</span><span class="p">)</span>


    <span class="c">#-------------------------------------------------------------- File control</span>

<div class="viewcode-block" id="Experiment.setFilenames"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.setFilenames">[docs]</a>    <span class="k">def</span> <span class="nf">setFilenames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basePath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the filenames and open the files.</span>
<span class="sd">        </span>
<span class="sd">        Use the supplied `baseName` to generate names for the data and</span>
<span class="sd">        parameter files, as well as the graph image file if applicable, by</span>
<span class="sd">        appending the appropriate extensions. Then open the files. Write</span>
<span class="sd">        the column headers to the data file and dump the parameter buffer</span>
<span class="sd">        into the parameter file.</span>
<span class="sd">        </span>
<span class="sd">        Important: All folders in the path to the files must already exist.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        basePath : str</span>
<span class="sd">            The path where the data files should be stored. It should include</span>
<span class="sd">            all folders as well as a filename. The extension may be left off,</span>
<span class="sd">            but the only extensions that will be understood are &quot;.xdat&quot; (the</span>
<span class="sd">            default), &quot;.txt&quot; and &quot;.dat&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_closeFiles</span><span class="p">()</span>
        
        <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">_EXTS_DATA</span><span class="p">:</span>
            <span class="n">dotext</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">ext</span>
            <span class="k">if</span> <span class="n">basePath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">dotext</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_extension</span> <span class="o">=</span> <span class="n">ext</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filenameBase</span> <span class="o">=</span> <span class="n">basePath</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">dotext</span><span class="p">)]</span>
                <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filenameBase</span> <span class="o">=</span> <span class="n">basePath</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extension</span> <span class="o">=</span> <span class="n">_EXTS_DATA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c"># Open the data file and write the headers.</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filenameBase</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extension</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Opening data file: &#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columnArray</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">columnName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">columnName</span><span class="p">][</span><span class="s">&#39;colindex&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">columnName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="c"># Open the parameter file and dump the parameter buffer.</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filenameBase</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">_EXTS_PARAMETERS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Opening parameter file: &#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameterFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameterFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span> <span class="o">=</span> <span class="p">[]</span>
        </div>
    <span class="k">def</span> <span class="nf">_closeFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close the files.</span>
<span class="sd">        </span>
<span class="sd">        First, write the last row of data to the file (since writing to the</span>
<span class="sd">        file is normally determined by collisions, the last line will never</span>
<span class="sd">        be written without this). Then close the data and parameter files if</span>
<span class="sd">        they are open. Then attempt to save any graphs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;curr&#39;</span><span class="p">]</span> <span class="k">for</span>
                                            <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columnArray</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataFile</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameterFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameterFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameterFile</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graphManager</span><span class="o">.</span><span class="n">saveGraphs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filenameBase</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> 
                                                    <span class="n">_EXTS_IMAGE</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_allFiles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_filenameBase</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extension</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_filenameBase</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> 
                                            <span class="n">_EXTS_PARAMETERS</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_filenameBase</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">_EXTS_IMAGE</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">NotImplementedError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">),</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_allFiles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_filenameBase</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extension</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_filenameBase</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> 
                                            <span class="n">_EXTS_PARAMETERS</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="bp">None</span><span class="p">))</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Problem with graph manager. Graphs cannot be saved.&#39;</span> <span class="o">+</span>
                      <span class="s">&#39;</span><span class="se">\n</span><span class="s">&gt;&gt;&gt;&gt;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

<div class="viewcode-block" id="Experiment.getFiles"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getFiles">[docs]</a>    <span class="k">def</span> <span class="nf">getFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of all files used so far in the experiment.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of tuple of str</span>
<span class="sd">            A list of tuples. Each tuple represents one set of files opened and</span>
<span class="sd">            contains three strings. The first is a data file, the second is</span>
<span class="sd">            a parameter file, and the third is a graph file (the third can be</span>
<span class="sd">            `None` if no graph file was saved).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_allFiles</span><span class="p">)</span>

    <span class="c">#------------------------------------------ Interaction with user interfaces</span>
</div>
<div class="viewcode-block" id="Experiment.setInteractionParameters"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.setInteractionParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setInteractionParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set how the experiment should communicate with the outside.</span>
<span class="sd">        </span>
<span class="sd">        These parameters can be set only using keyword arguments.</span>
<span class="sd">        </span>
<span class="sd">        Any parameter which takes a list can be disabled by setting it to an</span>
<span class="sd">        empty list. Any parameter which takes something else can be disabled</span>
<span class="sd">        by setting it to `None`.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parentFrame : Frame</span>
<span class="sd">            A graphical frame which will be passed as the parent for the</span>
<span class="sd">            graph frames, if applicable.</span>
<span class="sd">        graphManagerClass : GraphManager</span>
<span class="sd">            A class (not an instance) to use for managing the graph threads,</span>
<span class="sd">            if applicable.</span>
<span class="sd">        graphManager : GraphManager</span>
<span class="sd">            A GraphManager **object** for managing the graph threads. If this</span>
<span class="sd">            is set, it will be preferred over creating a graphManagerClass.</span>
<span class="sd">        preSequenceCommands : list of Command</span>
<span class="sd">            A list of `Command` objects which should be executed immediately</span>
<span class="sd">            before the experiment begins to run.</span>
<span class="sd">        postSequenceCommands : list of Command</span>
<span class="sd">            A list of `Command` objects which should be executed immediately</span>
<span class="sd">            after the experiment has finished.</span>
<span class="sd">        statusMonitor : statusMonitor</span>
<span class="sd">            The new `StatusMonitor` object for the instruments to display</span>
<span class="sd">            information to the user.</span>
<span class="sd">        loopEnterCommands : list of Command</span>
<span class="sd">            The `Command` objects to execute before any other actions when the</span>
<span class="sd">            sequence enters an interruptable loop.</span>
<span class="sd">        loopExitCommands : list of Command</span>
<span class="sd">            The `Command` objects to execute after any other actions when an</span>
<span class="sd">            interruptable loop has been interrupted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s">&#39;parentFrame&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parentFrame</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;parentFrame&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;graphManager&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graphManager</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;graphManager&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;graphManagerClass&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graphManagerClass</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;graphManagerClass&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;preSequenceCommands&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preSequenceActions</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;preSequenceCommands&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;postSequenceCommands&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_postSequenceActions</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;postSequenceCommands&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;statusMonitor&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_statusMonitor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;statusMonitor&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;loopEnterCommands&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loopEnterCommands</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;loopEnterCommands&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;loopExitCommands&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loopExitCommands</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;loopExitCommands&#39;</span><span class="p">]</span>


    <span class="c">#------------------------------------------------------ Experiment execution</span>
</div>
<div class="viewcode-block" id="Experiment.run"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">errorCheck</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform the pre-sequence actions and begin the experiment.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        errorCheck : bool</span>
<span class="sd">            Whether to check for errors before beginning execution. The default</span>
<span class="sd">            is `True`.</span>
<span class="sd">            </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GeneralExperimentError</span>
<span class="sd">            An exception containing a list of warnings and errors about</span>
<span class="sd">            problems with the experiment. This is only raised if `errorCheck`</span>
<span class="sd">            is `True`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">errorCheck</span><span class="p">:</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkSequenceForErrors</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Errors detected.&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Severity: [</span><span class="si">%s</span><span class="s">]. Message: [</span><span class="si">%s</span><span class="s">]&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">GeneralExperimentError</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;Running experiment without checking for errors.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preSequence</span><span class="p">()</span>
            <span class="n">mainThread</span> <span class="o">=</span> <span class="n">ExecutionThread</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">mainThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Cannot run: the sequence is already running.&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Experiment.pause"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.pause">[docs]</a>    <span class="k">def</span> <span class="nf">pause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pause the experiment.&quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Pausing the experiment.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Experiment.resume"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.resume">[docs]</a>    <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unpause the experiment.&quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Resuming the experiment.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Experiment.abort"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.abort">[docs]</a>    <span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stop the experiment and run the post-sequence actions.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_postSequence</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Experiment.interruptLoop"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.interruptLoop">[docs]</a>    <span class="k">def</span> <span class="nf">interruptLoop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interrupt a running loop.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Experiment.isRunning"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.isRunning">[docs]</a>    <span class="k">def</span> <span class="nf">isRunning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the experiment is running.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Whether the experiment is running.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Experiment.isPaused"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.isPaused">[docs]</a>    <span class="k">def</span> <span class="nf">isPaused</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the experiment has been paused.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            Whether the experiment is paused.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Experiment.isInterrupted"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.isInterrupted">[docs]</a>    <span class="k">def</span> <span class="nf">isInterrupted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the next loop should be interrupted.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            Whether a loop has been manually interrupted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
    <span class="k">def</span> <span class="nf">_preSequence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepare the experiment to execute.&quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Starting pre-sequence...&#39;</span><span class="p">)</span>

        <span class="c"># Set the &quot;running&quot; flag to true.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># Execute any pre-sequence actions specified by the user.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preSequenceActions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preSequenceActions</span><span class="p">:</span>
                    <span class="n">action</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Invalid pre-sequence action list&#39;</span><span class="p">)</span>

        <span class="c"># Initialize the instruments.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatReSTHeading</span><span class="p">(</span><span class="s">&#39;Instruments&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instruments</span><span class="p">:</span>
            <span class="n">instrument</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statusMonitor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">instrument</span><span class="o">.</span><span class="n">setStatusMonitor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statusMonitor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">getInformation</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="c"># Write the defined data to the parameter buffer.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatReSTHeading</span><span class="p">(</span><span class="s">&#39;Constants&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">constant</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> : </span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">constant</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatReSTHeading</span><span class="p">(</span><span class="s">&#39;Sequence&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span><span class="o">.</span><span class="n">getTreeString</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameterBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatReSTHeading</span><span class="p">(</span><span class="s">&#39;Parameters&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c"># Prepare all actions for execution (including ensuring that they</span>
        <span class="c"># refer to this experiment).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span><span class="o">.</span><span class="n">setExperiment</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">applyActionCommands</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Set the pre- and post-loop actions for interruptable loops.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">ActionLoopUntilInterrupt</span><span class="p">):</span>
                <span class="n">action</span><span class="o">.</span><span class="n">setLoopCommands</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loopEnterCommands</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">_loopExitCommands</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_traverse</span><span class="p">(</span><span class="n">applyActionCommands</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statusMonitor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span><span class="o">.</span><span class="n">setStatusMonitor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statusMonitor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span><span class="o">.</span><span class="n">prepareToExecute</span><span class="p">()</span>

        <span class="c"># Prepare columns to store data (i.e. number them).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepareColumns</span><span class="p">()</span>

        <span class="c"># Prepare and start the graph manager.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphManagerClass</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphManager</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_graphManager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphManagerClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parentFrame</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphManager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">enabledGraphs</span> <span class="o">=</span> <span class="p">[</span><span class="n">gph</span> <span class="k">for</span> <span class="n">gph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span> <span class="k">if</span> <span class="n">gph</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">()]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_graphManager</span><span class="o">.</span><span class="n">setGraphs</span><span class="p">(</span><span class="n">enabledGraphs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_graphManager</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">NotImplementedError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">),</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Problem with graph manager...proceeding without &#39;</span> <span class="o">+</span>
                      <span class="s">&#39;graphs.</span><span class="se">\n</span><span class="s">&gt;&gt;&gt;&gt;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Pre-sequence finished.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_postSequence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Free resources and clear stored data.&quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Starting post-sequence...&#39;</span><span class="p">)</span>

        <span class="c"># Finalize all instruments</span>
        <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instruments</span><span class="p">:</span>
            <span class="n">instrument</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>

        <span class="c"># Abort the graph manager and clear graph data</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graphManager</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Problem with graph manager...cannot abort.&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c"># Close files (and save graphs, if applicable)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_closeFiles</span><span class="p">()</span>
        
        <span class="c"># Execute postprocessorAction objects</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocessorActions</span><span class="p">:</span>
            <span class="n">action</span><span class="o">.</span><span class="n">executeReal</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_postprocessorActions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allFiles</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Delete the convenience attributes in the `Action` objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span><span class="o">.</span><span class="n">cleanupAfterExecution</span><span class="p">()</span>

        <span class="c"># Empty the column and parameter information storage.</span>
        <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span>
            <span class="n">col</span><span class="p">[</span><span class="s">&#39;curr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">col</span><span class="p">[</span><span class="s">&#39;colindex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_columnArray</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Reset the running flag to False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># Execute user-defined post-sequence actions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postSequenceActions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postSequenceActions</span><span class="p">:</span>
                    <span class="n">action</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Invalid post-sequence action list.</span><span class="se">\n</span><span class="s">&gt;&gt;&gt;&gt;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

        <span class="c"># Clear the status monitor</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statusMonitor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_statusMonitor</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Post-sequence finished.&#39;</span><span class="p">)</span>


    <span class="c">#------------------------------------------------------------ Helper methods</span>

    <span class="k">def</span> <span class="nf">_traverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Scan the action sequence, applying a function to each element.&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">traverseAux</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Helper for traverse. Actually does the work.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">allowsChildren</span><span class="p">():</span>
                <span class="n">children</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getChildren</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                    <span class="n">func</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                    <span class="n">traverseAux</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span><span class="p">)</span>
        <span class="n">traverseAux</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>


    <span class="c">#---------------------------------------------------------- Data persistence</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary of the defining properties of the experiment.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The full dictionary of the class except that those elements</span>
<span class="sd">            are incompatible with `pickle` have been removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">odict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_parentFrame&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_graphManager&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_graphManagerClass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_preSequenceActions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_postSequenceActions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_loopEnterCommands&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_loopExitCommands&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">]</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_statusMonitor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">odict</span><span class="p">[</span><span class="s">&#39;_postprocessorActions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">odict</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the dictionary defining the properties of the experiment.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
        
<div class="viewcode-block" id="Experiment.getXML"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.getXML">[docs]</a>    <span class="k">def</span> <span class="nf">getXML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an XML string representing the experiment.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A string containing XML data representing all of the data related</span>
<span class="sd">            to an experiment, possibly useful as an alternative to pickle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&lt;experiment&gt;&#39;</span><span class="p">]</span>
        
        <span class="c"># Process the constants</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;  &lt;constants&gt;&#39;</span><span class="p">)</span>
        <span class="n">tempformat</span> <span class="o">=</span> <span class="s">&#39;    &lt;constant name=&quot;</span><span class="si">%s</span><span class="s">&quot; value=&quot;</span><span class="si">%s</span><span class="s">&quot; /&gt;&#39;</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">tempformat</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constants</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;  &lt;/constants&gt;&#39;</span><span class="p">)</span>
        
        <span class="c"># Process the instruments</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;  &lt;instruments&gt;&#39;</span><span class="p">)</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">getXML</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instruments</span><span class="p">])</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;  &lt;/instruments&gt;&#39;</span><span class="p">)</span>
        
        <span class="c"># Process the actions</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;  &lt;sequence&gt;&#39;</span><span class="p">)</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span><span class="o">.</span><span class="n">getXML</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;  &lt;/sequence&gt;&#39;</span><span class="p">)</span>
        
        <span class="c"># Process the graphs</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;  &lt;graphs&gt;&#39;</span><span class="p">)</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">getXML</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="p">])</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;  &lt;/graphs&gt;&#39;</span><span class="p">)</span>
        
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt;/experiment&gt;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
        
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Experiment.open"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open an experiment from a file.&quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inputFile</span><span class="p">:</span>
            <span class="n">expt</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">inputFile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">expt</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Experiment.save"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.Experiment.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save an experiment to a file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outputFile</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>



<span class="c">#--------------------------------------------------------------- ExecutionThread</span>
</div></div>
<div class="viewcode-block" id="ExecutionThread"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.ExecutionThread">[docs]</a><span class="k">class</span> <span class="nc">ExecutionThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class for executing the sequence without blocking the program.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExecutionThread</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span> <span class="o">=</span> <span class="n">experiment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Experiment Thread Starter&#39;</span>

<div class="viewcode-block" id="ExecutionThread.run"><a class="viewcode-back" href="../../../api_core_experiment.html#src.core.experiment.ExecutionThread.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Begin executing the main sequence.&quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Main sequence started.&#39;</span><span class="p">)</span>
        <span class="n">actionThread</span> <span class="o">=</span> <span class="n">ActionThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">getActionRoot</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">actionThread</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Main Experiment Thread&#39;</span>
        <span class="n">actionThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">actionThread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Main sequence finished.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>


<span class="c">#-------------------------------------------------------------- Helper functions</span>
</div></div>
<span class="k">def</span> <span class="nf">_checkExpressionForErrors</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">allProperties</span><span class="p">,</span> <span class="n">definedProperties</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return errors related to undefined data bins.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expression : str</span>
<span class="sd">        The expression to check for errors.</span>
<span class="sd">    allProperties : tuple of list of str</span>
<span class="sd">        A tuple of lists. The first list contains the names of all constants</span>
<span class="sd">        defined in the experiment. The second contains the names of all</span>
<span class="sd">        columns, and the third contains the names of all parameters.</span>
<span class="sd">    definedProperties : tuple of list of str</span>
<span class="sd">        A tuple of lists. The first list contains the names of the columns</span>
<span class="sd">        which have been defined by the time the expression is to be evaluated,</span>
<span class="sd">        and the second contains the names of parameters defined up to that</span>
<span class="sd">        same point.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list of tuple of str</span>
<span class="sd">        A list of tuples, where each tuple contains two elements. The first</span>
<span class="sd">        is either &#39;warning&#39; or &#39;error&#39;, depending on the severity of the </span>
<span class="sd">        problem, and the second is a message giving more detail about the</span>
<span class="sd">        problem.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">constants</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">allProperties</span>
    <span class="n">definedColumns</span><span class="p">,</span> <span class="n">definedParameters</span> <span class="o">=</span> <span class="n">definedProperties</span>
    <span class="n">needConst</span><span class="p">,</span> <span class="n">needCol</span><span class="p">,</span> <span class="n">needParam</span> <span class="o">=</span> <span class="n">parsing</span><span class="o">.</span><span class="n">extractNames</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">needConst</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constants</span><span class="p">:</span>
            <span class="n">answer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="s">&#39;Undefined constant in &#39;</span> <span class="o">+</span>
                           <span class="s">&#39;expression [</span><span class="si">%s</span><span class="s">]: [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span>
                           <span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">item</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">needCol</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="n">answer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="s">&#39;Undefined column in &#39;</span> <span class="o">+</span>
                           <span class="s">&#39;expression [</span><span class="si">%s</span><span class="s">]: [</span><span class="si">%s</span><span class="s">].&#39;</span> <span class="o">%</span>
                           <span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">item</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">definedColumns</span><span class="p">:</span>
            <span class="n">answer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;warning&#39;</span><span class="p">,</span> <span class="s">&#39;Column referenced before &#39;</span> <span class="o">+</span>
                           <span class="s">&#39;assignment in expression &#39;</span> <span class="o">+</span>
                           <span class="s">&#39;[</span><span class="si">%s</span><span class="s">]: [</span><span class="si">%s</span><span class="s">]. Zero will be used.&#39;</span> <span class="o">%</span>
                           <span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">item</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">needParam</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">answer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="s">&#39;Undefined parameter in &#39;</span> <span class="o">+</span>
                           <span class="s">&#39;expression [</span><span class="si">%s</span><span class="s">]: [</span><span class="si">%s</span><span class="s">].&#39;</span> <span class="o">%</span>
                           <span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">item</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">definedParameters</span><span class="p">:</span>
            <span class="n">answer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;warning&#39;</span><span class="p">,</span> <span class="s">&#39;Parameter referenced &#39;</span> <span class="o">+</span>
                           <span class="s">&#39;before assignment in expression &#39;</span> <span class="o">+</span>
                           <span class="s">&#39;[</span><span class="si">%s</span><span class="s">]: [</span><span class="si">%s</span><span class="s">]. Zero will be used.&#39;</span> <span class="o">%</span>
                           <span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">item</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">answer</span>

<span class="k">def</span> <span class="nf">_getCreatedBins</span><span class="p">(</span><span class="n">inputProperties</span><span class="p">,</span> <span class="n">outputProperties</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the parameters and columns defined by an action.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    inputProperties : list of dict</span>
<span class="sd">        A list of dictionaries of the form returned by the `Action` class&#39;s</span>
<span class="sd">        `getInputProperties()` method.</span>
<span class="sd">    outputProperties : list of dict</span>
<span class="sd">        A list of dictionaries of the form returned by the `Action` class&#39;s</span>
<span class="sd">        `getOutputProperties()` method.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of list of str</span>
<span class="sd">        A tuple consisting of two lists, the first of which names all the </span>
<span class="sd">        columns created by the relevant action, and the second names all the</span>
<span class="sd">        parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">definedColumns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">definedParameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">inputProperties</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">&#39;column&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">MARK_PARAMETER</span><span class="p">):</span>
            <span class="n">parameterName</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">MARK_PARAMETER</span><span class="p">):]</span>
            <span class="k">if</span> <span class="n">parameterName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">definedParameters</span><span class="p">:</span>
                <span class="n">definedParameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameterName</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">definedColumns</span><span class="p">:</span>
            <span class="n">definedColumns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">outputProperties</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">&#39;column&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">MARK_PARAMETER</span><span class="p">):</span>
            <span class="n">parameterName</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">MARK_PARAMETER</span><span class="p">):]</span>
            <span class="k">if</span> <span class="n">parameterName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">definedParameters</span><span class="p">:</span>
                <span class="n">definedParameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameterName</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">definedColumns</span><span class="p">:</span>
            <span class="n">definedColumns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">definedColumns</span><span class="p">,</span> <span class="n">definedParameters</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Transport Experiment 1.5.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Thomas C. Flanagan.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>